# http://wiki.openwrt.org/doc/uci#file.syntax
# http://wiki.openwrt.org/doc/uci#uci.paths


# olsrd2 --load /etc/olsrd2.conf --schema=log.debug 
# olsrd2 --load /etc/olsrd2.conf --set log.debug=os_system
# olsrd2 --load /etc/olsrd2.conf --set domain.table=233
#
# make package/oonf-api-git/clean
# make package/olsrd2-git/clean
#
# auf loopback: option ip6assign 60 -> gives ULA = uci set network.loopback.ip6assign=60
# echo "/nhdp iflink"    | nc 127.0.0.1 2009
# echo "/nhdp neighlink" | nc 127.0.0.1 2009
# echo "/layer2 net"     | nc 127.0.0.1 2009



uci add network  cityVPN
uci set network.@cityVPN[-1].interface='tap0'
uci set network.@cityVPN[-1].proto=static

uci set network.cityVPN=interface
uci set network.cityVPN.proto=static
uci set network.cityVPN.interface=tap0


# profiling in scheduler_run()
# olsr-uptime/neustarts zeigen


vtund_build_type()
{
	local file='/tmp/vtund_build_type'

	[ -e "$file" ] || {
		set -- $( ldd /usr/sbin/vtund )
		case "$@" in
			*'liblzo'*'libcrypto'*)
				echo >"$file" 'LZOSSL'
			;;
			*'liblzo'*)
				echo >"$file" 'LZOnoSSL'
			;;
			*)
				echo >"$file" 'noLZOnoSSL'
			;;
		esac
	}

	cat "$file"
}

# vtund: noSSL, noLZO
# root@bebelplatz4-triererstr:~ ldd /usr/sbin/vtund
	libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x77761000)
	libc.so.0 => /lib/libc.so.0 (0x776f4000)
	ld-uClibc.so.0 => /lib/ld-uClibc.so.0 (0x77784000)
# vtund: noSSL, LZO
# root@EG-labor-AP:~ ldd /usr/sbin/vtund
        libz.so.1 => /usr/lib/libz.so.1 (0x774c6000)
        liblzo2.so.2 => /usr/lib/liblzo2.so.2 (0x774a4000)
        libgcc_s.so.1 => /lib/libgcc_s.so.1 (0x77480000)
        libc.so.0 => /lib/libc.so.0 (0x77413000)
        ld-uClibc.so.0 => /lib/ld-uClibc.so.0 (0x774e4000)
# vtund: SSL + LZO
# bastian@X301:~$ ldd /usr/sbin/vtund
	linux-gate.so.1 =>  (0xb7771000)
	libz.so.1 => /lib/i386-linux-gnu/libz.so.1 (0xb7739000)
	liblzo2.so.2 => /usr/lib/i386-linux-gnu/liblzo2.so.2 (0xb7716000)
	libcrypto.so.1.0.0 => /lib/i386-linux-gnu/libcrypto.so.1.0.0 (0xb756a000)
	libutil.so.1 => /lib/i386-linux-gnu/libutil.so.1 (0xb7566000)
	libc.so.6 => /lib/i386-linux-gnu/libc.so.6 (0xb73b2000)
	libdl.so.2 => /lib/i386-linux-gnu/libdl.so.2 (0xb73ad000)
	/lib/ld-linux.so.2 (0xb7772000)




# cron.min-ping fails -> inet_stable
# shoutbox jenaplan 

# 24h-tickets adagio

# vpn zwischen zwei entfernten nodes?
# tap0 als olsr-interface
# ipip-tunnel?

# auf 10.63.19.97 (Matterhorn)
list LinkQualityMult '10.63.45.2 0.5'           # christian
list LinkQualityMult '10.63.95.65 0.8'          # matterhorn -> wachturm (soll ethernet)
list LinkQualityMult '10.63.19.65 0.7'          # F36dach


# build: echo 'bittorf-wireless.com' >/proc/sys/kernel/hostname


# implement mac-to-IPv6-UEI-64
# ftp://ftp.rfc-editor.org/in-notes/rfc3513.txt
# http://www8.cs.umu.se/~c05hed/mac2ipv6.php?mac=B0%3A48%3A7A%3ABE%3ACA%3A46
# http://ben.akrin.com/?p=1347
#
# LAN-MAC: 74:ea:3a:      db:15:aa
#    fe80::76.ea:3a.ff:fe.db:15.aa/64
#
# d.h.:
# - umrechnen in 'locally_administered'
# - 3 bytes links + 3 bytes rechts
# - in die mitte komt ff:fe
# - fe80:: davorsetzen
# - ping6 $ip%$iface


# https://wiki.ubuntu.com/DashAsBinSh


# dcf77
# ln -s /dev/ttyUSB0 /dev/refclock-0
#
root@703n:~ cat /etc/ntp.conf 
# use a random selection of 4 public stratum 2 servers
# see http://twiki.ntp.org/bin/view/Servers/NTPPoolServers
#restrict default nomodify notrap noquery
#restrict default noquery
driftfile  /var/lib/ntp/ntp.drift
server 127.127.8.0 prefer mode 14
restrict default ignore
restrict 127.127.8.0 nomodify
restrict 127.0.0.1 nomodify
restrict 10.0.0.0 mask 255.0.0.0 nomodify
logfile /tmp/ntp.txt
logconfig =all
#
#
ntpq -c clocklist
ntpq -c peers
ntpq -c cv -c rv





test -e /tmp/HHH || {
 set | grep -v ^strong_debug= | grep -v ^logfile= | grep -v ^line= | grep -v ^funcname= | grep -v ^file= | grep -v ^board= | grep ^[a-z] >/tmp/HHH2 && {
  cat /tmp/HHH2 >/tmp/HHH
  echo "$line" >>/tmp/HHH
  date >>/tmp/HHH
 }
}



root@KG-serverraum-MESH:~ ip n|grep 00:19:99:d0:da:e8
fe80::1c4:ee8c:6f32:7bf5 dev eth0.1 lladdr 00:19:99:d0:da:e8 STALE
10.63.4.53 dev eth0.1 lladdr 00:19:99:d0:da:e8 REACHABLE
10.63.4.55 dev eth0.1 lladdr 00:19:99:d0:da:e8 STALE



root@4900erHybrid-kueche:~ ip n|fgrep 10.63.222.
10.63.222.3 dev wlan0 lladdr 64:70:02:d3:24:0c STALE
10.63.222.1 dev wlan1 lladdr 64:70:02:d3:24:0b STALE
10.63.222.1 dev wlan0 lladdr 64:70:02:d3:24:0c STALE



Wed Apr 16 11:33:06 2014 daemon.info dnsmasq-dhcp[2505]: DHCPDISCOVER(eth0.1) 00:23:8b:a5:18:dc
Wed Apr 16 11:33:06 2014 daemon.info dnsmasq-dhcp[2505]: DHCPOFFER(eth0.1) 10.63.11.113 00:23:8b:a5:18:dc
Wed Apr 16 11:33:06 2014 daemon.info dnsmasq-dhcp[2505]: DHCPREQUEST(eth0.1) 10.63.11.113 00:23:8b:a5:18:dc
Wed Apr 16 11:33:06 2014 daemon.info dnsmasq-dhcp[2505]: DHCPACK(eth0.1) 10.63.11.113 00:23:8b:a5:18:dc InaMichalski-PC
Wed Apr 16 11:33:24 2014 daemon.alert fff+ /etc/dhcp-script.d/10dhcpscript netfilter_user_reachable(): no_success: mac: 00:23:8b:a5:18:dc ip: 10.63.11.112 devlist: 'eth0.1  wlan0  wlan0-1 '
Wed Apr 16 11:33:24 2014 daemon.info fff+ /etc/dhcp-script.d/10dhcpscript netfilter_user_add(): [ERR] unreachable - mac: '00:23:8b:a5:18:dc' ip: '10.63.11.112'
Wed Apr 16 11:33:24 2014 daemon.info fff+ /etc/dhcp-script.d/10dhcpscript dhcp_del(): '00:23:8b:a5:18:dc' is from 'eth0.1' = lan-DEV
Wed Apr 16 11:33:24 2014 daemon.info fff+ /etc/dhcp-script.d/10dhcpscript dhcp_add(): '00:23:8b:a5:18:dc' is from 'eth0.1' = lan-DEV
Wed Apr 16 11:33:24 2014 daemon.info fff+ /etc/dhcp-script.d/10dhcpscript mac_is_from_lan(): mac 00:23:8b:a5:18:dc is from LAN
Wed Apr 16 11:33:24 2014 daemon.info fff+ /etc/dhcp-script.d/10dhcpscript EG-steinmetzBuero_dhcp-add(): [OK] _weblogin login_check 00:23:8b:a5:18:dc
Wed Apr 16 11:34:01 2014 user.notice root: debug: phy: phy0 interval: 60 avg: 245 avg_overall: 225 change: -8%
Wed Apr 16 11:35:01 2014 user.notice root: debug: phy: phy0 interval: 60 avg: 223 avg_overall: 227 change: 1%
Wed Apr 16 11:35:47 2014 daemon.debug fff+ TERM:screen -ash netfilter_user_reachable(): probing: mac: 00:23:8b:a5:18:dc ip: 10.63.11.113 dev: 'eth0.1'
Wed Apr 16 11:35:47 2014 daemon.info fff+ TERM:screen -ash netfilter_user_add(): mac: 00:23:8b:a5:18:dc ip: 10.63.11.113



# https://dev.openwrt.org/ticket/15572
For small memory kernel optimized routing                                                                             
 {{{                                                                                                                   
 vm.min_free_kbytes=1                                                                                                  
 vm.vfs_cache_pressure=500                                                                                             
 vm.dirty_ratio=50                                                                                                     
 vm.overcommit_memory=0                                                                                                
 vm.overcommit_ratio=10                                                                                                
 vm.dirty_ratio=20                                                                                                     
 vm.dirty_expire_centisecs=1500                                                                                        
 vm.drop_caches=3                                                                                                      
 }}}                 


# fehler auf 1043er: (loeschen im bootloader ging nur bei 124/128)
Please press Enter to activate this console.

[   56.070000] jffs2: Short read from newly-erased block at 0x004d0000. Wanted 4096, got 0
[   96.070000] jffs2: Erase at 0x004c0000 failed immediately: errno -5
[  136.070000] jffs2: Erase at 0x004b0000 failed immediately: errno -5
[  176.080000] jffs2: Erase at 0x004a0000 failed immediately: errno -5
[  216.080000] jffs2: Erase at 0x00490000 failed immediately: errno -5
[  256.080000] jffs2: Erase at 0x00480000 failed immediately: errno -5
[  296.080000] jffs2: Erase at 0x00470000 failed immediately: errno -5
[  336.080000] jffs2: Erase at 0x00460000 failed immediately: errno -5
[  376.080000] jffs2: Erase at 0x00450000 failed immediately: errno -5

###
root@OpenWrt:/# sysupgrade -n /tmp/fw
[  496.080000] jffs2: Erase at 0x00420000 failed immediately: errno -5
[  536.080000] jffs2: Erase at 0x00410000 failed immediately: errno -5
[  576.080000] jffs2: Erase at 0x00400000 failed immediately: errno -5
[  616.080000] jffs2: Erase at 0x003f0000 failed immediately: errno -5
[  656.080000] jffs2: Erase at 0x003e0000 failed immediately: errno -5
[  696.080000] end_request: I/O error, dev mtdblock5, sector 0
[  696.080000] Buffer I/O error on device mtdblock5, logical block 0
[  736.090000] end_request: I/O error, dev mtdblock5, sector 8
[  736.090000] Buffer I/O error on device mtdblock5, logical block 1
[  776.100000] end_request: I/O error, dev mtdblock5, sector 16
[  776.100000] Buffer I/O error on device mtdblock5, logical block 2
[  816.110000] end_request: I/O error, dev mtdblock5, sector 24
[  816.110000] Buffer I/O error on device mtdblock5, logical block 3
[  856.120000] end_request: I/O error, dev mtdblock5, sector 0
[  856.120000] Buffer I/O error on device mtdblock5, logical block 0
Invalid image, hardware ID mismatch, hw: image:10430001.
Image check 'platform_check_image' failed.






# txpower:
# iw dev "$ifname" set txpower fixed "${txpower%%.*}00"
# iw dev "wlan0" set txpower fixed "2000"

# nodejs:
# https://code.google.com/p/v8/wiki/BuildingWithGYP
# https://github.com/paul99/v8m-rb
# https://github.com/paul99/v8m-rb/pull/19
# http://fibasile.github.io/compiling-nodejs-for-arduino-yun.html
# http://linino.org/doku.php?id=wiki:nodejsbuild#the_easy_waydownload_the_compiled_linino_toolchain_and_the_openwrt_sdk
# http://stackoverflow.com/questions/22914681/cross-compiling-node-js-modules-on-mips-big-endian
# https://forum.openwrt.org/viewtopic.php?id=34410
# https://github.com/brimstone/nodejs-openwrt

# RippleOS: http://www.right.com.cn/forum/thread-134949-1-1.html

# openwrt-desktop
# https://github.com/larsclausen/

# find . -type f -name Makefile | xargs fgrep 'rb532'

# USB/3G-Modems/Openwrt: http://ofmodemsandmen.com/downloads.html

# openwrt: USB: 5 ghz: https://forum.openwrt.org/viewtopic.php?id=48248

# bluetooth-networking: http://giovanni.wordpress.com/2007/04/06/how-to-use-tcpip-over-bluetooth/

# javascript: http://wiki.openwrt.org/toh/start

# store data:
Please don't use /var/state for more network related stuff like this.                                                                          
You can use something like the following:                                                                                                      
ubus call network.interface.<name> set_data '{ "name": "value" }'                                                                              
                                                                                                                                               
That way you can store name/value pairs in the per-interface data in                                                                           
netifd, which you can retrieve via interface status. When the interface                                                                        
goes down, the data is cleared again, so cleanup is easy.          

# 60 GHz:
# http://wireless.kernel.org/en/users/Drivers/wil6210
# https://wikidevi.com/wiki/List_of_802.11ad_Hardware
# http://wilocity.com/products/reference-designs


# http://news.gmane.org/gmane.comp.embedded.pandaboard

### monami:

root@E2-buerooben-MESH:~ ip a
1: lo: <LOOPBACK,UP,LOWER_UP> mtu 16436 qdisc noqueue state UNKNOWN 
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 brd 127.255.255.255 scope host lo
2: eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc pfifo_fast state UP qlen 1000
    link/ether 00:13:10:0a:d5:8b brd ff:ff:ff:ff:ff:ff
    inet 192.168.1.1/24 brd 192.168.1.255 scope global eth0
4: eth0.0@eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP 
    link/ether 00:13:10:0a:d5:8b brd ff:ff:ff:ff:ff:ff
    inet 10.63.6.33/27 brd 10.63.6.63 scope global eth0.0
5: eth0.1@eth0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP 
    link/ether 00:13:10:0a:d5:8b brd ff:ff:ff:ff:ff:ff
    inet 192.168.2.10/24 brd 192.168.2.255 scope global eth0.1
6: wlan0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1500 qdisc mq state UP qlen 32
    link/ether 00:13:10:0a:d5:8d brd ff:ff:ff:ff:ff:ff
    inet 10.63.6.1/8 brd 10.255.255.255 scope global wlan0

if ping -c1 192.168.2.1; then
        touch '/tmp/GWSEEN'
else
        [ -e '/tmp/GWSEEN' ] && {
		ip a >/www/gw_lost.$$
		_system crashreboot 'gw_lost'
	}
fi

### monamiEND


# eigenes paket anlegen, z.b.
# package/utils/arduino-serial
# Makefile reinkopieren
# make menuconfig -> aktivieren
# make package/arduino-serial/compile	# achtung: ohne 'utils'
#
# e.g.: menuconfig -> lang
define Package/node
  DEPENDS:=+libpthread +librt +uclibcxx
  SECTION:=lang
  CATEGORY:=Languages
  TITLE:=Node.js is a platform built on Chrome's JavaScript runtime
  URL:=http://nodejs.org/
endef




# 

# checkout: darkstat

# Dave Taht: Re: [Battlemesh] recommendations for 40Km Link
# http://snapon.lab.bufferbloat.net/~cero2/jimreisert/results.html
# netperf-wrapper -l 60 --disable-log -p all_scaled -o mytest.svg -H                                                                                           # server -t 'test title' rrul_be # or rrul                 

# http://de.wikipedia.org/wiki/Andrew_File_System

# openwrt / panda:
# list files on ext2 on part2:
# ext2ls mmc 0:2
# load:
# load mmc 0:2 0x80300000 openwrt-omap-zImage
# bootz 0x80300000
#
# partition1 = fat16 -> files: 'MLO' + 'u-boot'
# partition2 = ext4  -> files: rootfs + /boot + /boot/zImage + /boot/*.dtb



# rebuild kernel:
# make target/linux/clean
# make target/install

# /sys/kernel/debug/ieee80211/phy0/ath9k/reset
# /sys/kernel/debug/ieee80211/phy*/ath9k/interrupt
# /sys/kernel/debug/ieee80211/phy0/ath9k/queues
# for W in reset interrupt queues;do echo "$W"; cat /sys/kernel/debug/ieee80211/phy*/ath9k/$W; done
#
# echo 1 >/sys/kernel/debug/ieee80211/phy0/ath9k/disable_ani
# more debug: (https://dev.openwrt.org/ticket/15320#comment:29)
# echo 0x4409 > /sys/kernel/debug/ieee80211/phy0/ath9k/debug

# TEMPer2:
# https://github.com/s-leroux/TEMPer2/blob/master/Makefile
# https://github.com/s-leroux/TEMPer2
# http://dp.nonoo.hu/measuring-temperature-using-openwrt/
# openwrt 0c45:7401
# https://dev.openwrt.org/ticket/10577
# https://dev.openwrt.org/attachment/ticket/10577/temper.zip



root: ich = 'dnt3' nachbar = '/tmp/dnt1.log' : signal: -56 [-56] dBm
root: ich = 'dnt3' nachbar = '/tmp/dnt1.log' : signal avg: -56 [-56] dBm
root: trying ec:88:8f:c6:69:3a
root: ich = 'dnt3' nachbar = '/tmp/dnt2.log' : signal: -53 [-53] dBm
root: ich = 'dnt3' nachbar = '/tmp/dnt2.log' : signal avg: -53 [-53] dBm
root: trying 6c:e8:73:eb:2b:90
Failed to connect to generic netlink.

   

92 root         0 SW   [kswapd0]
  137 root         0 SW   [fsnotify_mark]
  152 root         0 SW<  [ath79-spi]
  228 root         0 SW<  [deferwq]
  232 root         0 SW<  [kworker/0:1H]
  283 root         0 SW   [khubd]
  320 root         0 SWN  [jffs2_gcd_mtd3]
  381 root       908 S    /sbin/ubusd
  382 root       772 S    /sbin/askfirst ttyS0 /bin/ash --login
  623 root      2056 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
  838 root         0 SW   [kworker/u2:1]
  839 root         0 SW   [kworker/0:1]
 1570 root         0 SW<  [cfg80211]
 1662 root      1344 S    /sbin/logd
 1693 root      1488 S    /sbin/netifd
 1711 root      1160 S    /usr/sbin/odhcpd
 2036 root      1372 S    udhcpc -p /var/run/udhcpc-lo.pid -s /lib/netifd/dhcp
 2402 nobody    1020 S    /usr/sbin/dnsmasq -C /var/etc/dnsmasq.conf -k
 2421 root       976 S    /usr/sbin/dnsmasq -C /var/etc/dnsmasq.conf -k
 2548 root         0 SW   [kworker/u2:0]
 2675 nobody     904 S    /sbin/fakedns --address=/#/10.10.2.129 -p 5353
 2872 root      1100 S    /usr/sbin/dropbear -F -P /var/run/dropbear.1.pid -p
 2921 root      1672 S    /usr/sbin/uhttpd -f -h /www -r EG-INETrezeption-MESH
 2989 root      1380 S    /usr/sbin/crond -L /dev/null
 4246 root         0 SW   [kworker/0:0]
 4960 root      1544 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
 4967 root      1352 S    sleep 30
 4971 root      1352 S    sleep 30
 4975 root      1352 S    sleep 30
 4979 root      1352 S    sleep 30
 4983 root      1352 S    sleep 30
 4989 root      1352 S    sleep 30
 4991 root      1352 S    sleep 30
 4995 root      1352 S    sleep 30
 5005 root      1352 S    sleep 30
 5031 root      1360 R    ps
 5298 root      2120 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
 7265 root      1376 S    /usr/sbin/olsrd -f /var/etc/olsrd.conf -nofork
10387 root      2060 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
17601 root      2064 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
21168 root      2048 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
23580 root      2068 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
25042 root      2052 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
28763 root      2056 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
30385 root      2068 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL


# dynamic-client-portfw:
# list of mac's + mapping extern -> intern port (can be one than once per device)
# e.g. 00:11:22:33:44:55 -> 10080 -> 80 + 10443 -> 443

# do patch:
# proto_kill_command() -> /lib/netifd/netifd-proto.sh
# kill -l | grep ' USR1' | cut -d')' -f1


# do snake:
# http://bruxy.regnet.cz/web/linux/EN/housenka-bash-game/
# http://hackaday.com/2013/02/05/bash-games/
# http://codegolf.stackexchange.com/questions/4480/recreate-a-snake-game-in-a-console-terminal/4518#4518


# build old kernel with git://nbd.name/aa-mac80211.git

Mar 06 08:53:10 ' [up 7626s 5140480 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 08:53:12 ' [up 7628s 4583424 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/olsrd.6188.11.1394092386.core)
Mar 06 09:00:09 ' [up 8044s 4308992 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 09:00:11 ' [up 8046s 3788800 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 09:00:12 ' [up 8047s 3575808 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 09:00:13 ' [up 8048s 2912256 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 09:00:14 ' [up 8049s 2580480 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/olsrd.4551.10.1394092805.core)
Mar 06 09:00:15 ' [up 8050s 5816320 bytes free] /bin/sh [daemon.alert] watch_coredump() cron died, restarting
Mar 06 09:00:16 ' [up 8051s 5246976 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/r39139.ar71xx.crond.2510.10.1394092811.core
Mar 06 09:00:16 ' [up 8051s 3977216 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:16 ' [up 8051s 3944448 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.5893.11.1394092812.core)
Mar 06 09:00:16 ' [up 8052s 4493312 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:17 ' [up 8052s 3747840 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6130.11.1394092816.core)
Mar 06 09:00:17 ' [up 8052s 4337664 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:17 ' [up 8053s 3624960 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6129.11.1394092816.core)
Mar 06 09:00:17 ' [up 8053s 4198400 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:18 ' [up 8053s 2920448 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6320.11.1394092817.core)
Mar 06 09:00:18 ' [up 8053s 3432448 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:19 ' [up 8054s 3350528 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6244.11.1394092817.core)
Mar 06 09:00:19 ' [up 8054s 3977216 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:19 ' [up 8054s 2662400 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6397.6.1394092818.core)
Mar 06 09:00:19 ' [up 8055s 3403776 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:20 ' [up 8055s 3092480 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6392.11.1394092818.core)
Mar 06 09:00:20 ' [up 8055s 3723264 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:20 ' [up 8056s 3698688 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6547.11.1394092819.core)
Mar 06 09:00:20 ' [up 8056s 4276224 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:21 ' [up 8056s 3657728 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6546.11.1394092819.core)
Mar 06 09:00:21 ' [up 8056s 4227072 bytes free] /bin/sh [daemon.alert] watch_coredump() segfault in script, removing lockfiles
Mar 06 09:00:21 ' [up 8057s 4165632 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/sh.6759.11.1394092821.core)
Mar 06 09:16:15 ' [up 9010s 2756608 bytes free] /bin/sh [daemon.alert] watch_dns_resolution() dnsmasq died, old PIDs: '2549', restarted, PID now '11712 11710'
Mar 06 09:17:06 ' [up 9061s 4362240 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 09:17:09 ' [up 9064s 3563520 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/olsrd.5961.11.1394093825.core)
Mar 06 09:20:41 ' [up 9277s 2961408 bytes free] /bin/sh [daemon.alert] olsr_daemon() start: has_crashed
Mar 06 09:20:44 ' [up 9279s 2756608 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/null (low storage: was: /tmp/olsrd.12054.11.1394094035.core)
Mar 06 09:20:44 ' [up 9279s 5136384 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/r39139.ar71xx.hostapd.5813.11.1394094038.core
Mar 06 09:20:44 ' [up 9280s 5275648 bytes free] /bin/sh [daemon.alert] watch_coredump() cron died, restarting
Mar 06 09:20:45 ' [up 9281s 4767744 bytes free] /bin/sh [daemon.alert] watch_coredump() wrote: /dev/r39139.ar71xx.crond.6081.10.1394094041.core
Mar 06 09:21:32 ' [up 9328s 2121728 bytes free] /bin/sh [daemon.alert] scheduler_allow_run() removing lockfile, which seems to be left by accident
root@boltenhagendh-ap--75:~ date
Fri Mar  7 11:33:56 CET 2014
root@boltenhagendh-ap--75:~ reboot
root@boltenhagendh-ap--75:~ _system crashreboot




# how to configure the order of languages in captive portal
# HTTP_ACCEPT_LANGUAGE=de-DE,de;q=0.8,en-US;q=0.6,en;q=0.4
# reverse ssh tunnel
# sixxx.net / tunnelbroker.net 
# local repo for keys/design, so only 1 node must change
# password is in profile -> how profile looks like
# automount: ext2/vfat/btrfs


# nping -c1 --data-string "Geheimcode1234" 10.63.2.1

root@dhsylt-adhoc--72:~ ps
  PID USER       VSZ STAT COMMAND
    1 root      1344 R    /sbin/procd
    2 root         0 SW   [kthreadd]
    3 root         0 SW   [ksoftirqd/0]
    5 root         0 SW<  [kworker/0:0H]
    7 root         0 SW<  [khelper]
   58 root         0 SW<  [writeback]
   60 root         0 SW<  [bioset]
   62 root         0 SW<  [kblockd]
   92 root         0 SW   [kswapd0]
  137 root         0 SW   [fsnotify_mark]
  152 root         0 SW<  [ath79-spi]
  228 root         0 SW<  [deferwq]
  280 root         0 SW   [khubd]
  318 root         0 SWN  [jffs2_gcd_mtd3]
 1516 root         0 SW<  [bat_events]
 1617 root         0 SW<  [cfg80211]
 3284 root      1160 S    /usr/sbin/dropbear -F -P /var/run/dropbear.1.pid -p 22
 3315 root      1664 S    /usr/sbin/uhttpd -f -h /www -r dhsylt-adhoc--72 -c /etc/httpd.conf -x /cgi-bin -t 60 -T 30 -A 1 -E /cgi-bin-404.sh
 5298 root         0 SW   [kworker/0:0]
 5300 root         0 SW   [kworker/u2:2]
 6591 root      2192 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
10432 root         0 SW<  [kworker/0:1H]
12880 root      2204 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
17673 root      2204 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
18670 root      2176 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
19622 root      2184 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
20736 root      2184 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
20738 root         0 Z    [fgrep]
20739 root         0 Z    [cut]
20799 root      2204 R    /bin/sh -c . /tmp/CRON_IS_CAREFUL
21197 root      2204 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
21198 root      2204 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL
21199 root      1484 S    fgrep FILE: 'tarball.tgz'
21200 root      1484 S    cut -d  -f2
21204 root      1304 S    /sbin/logd
21205 root       880 S    /sbin/ubusd
21208 root         0 RW   [kworker/0:1]
21209 root         0 SW   [kworker/u2:0]
21210 root         0 SW   [kworker/0:2]
21211 root         0 SW   [kworker/u2:1]
21212 root      1204 S    /usr/sbin/dropbear -F -P /var/run/dropbear.1.pid -p 22
21213 root      1676 S    -ash
21218 root         0 SW   [kworker/u2:3]
21308 root      1488 R    ps
25156 root      1536 S    /sbin/netifd
25234 root         0 Z    [udhcpc]
29751 root      2192 S    /bin/sh -c . /tmp/CRON_IS_CAREFUL




# uh! r99:
root@EG-labor-AP:~ _firmware update_pmu
-ash: /tmp/kalua/firmware: line 6: _firmware_conf: not found
-ash: /tmp/kalua/firmware: romGwrootbin/db_backup.tgz: not found
-ash: /tmp/kalua/firmware: /www/NETFILTER_AUTOADD: not found
-ash: /tmp/kalua/firmware: /www/NETPARAM: Permission denied
-ash: /tmp/kalua/firmware: /etc/HARDWARE: Permission denied
-ash: /tmp/kalua/firmware: /www/switch.txt: Permission denied
-ash: /tmp/kalua/firmware: /www/SIMPLE_MESHNODE_FORCE_DHCP_LAN: not found
Connection to 10.63.99.33 closed.



# ethernet tot: 1043nd:
root@R5orange-E1technik-MESH:~ dmesg 
[28531.430000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[28533.760000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[28536.940000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[28546.430000] eth0: link down
[28546.450000] ar71xx: pll_reg 0xb8050014: 0x1a000000
[28546.450000] eth0: link up (1000Mbps/Full duplex)
[28547.820000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[28550.100000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
[28562.400000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
[28562.730000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready


# ubus call network.interface.lan status


# git clone git://nbd.name/aa-mac80211.git


# capture hostapd management traffic
http://wiki.openwrt.org/doc/devel/debugging#capture.management.traffic

# unstripped bauen:
make package/odhcpd/{clean,compile} STRIP=/bin/true

# alle originatoren:
set -- $( batctl o ); while [ -n "$1" ]; do case "$1" in *'/'*) ;; *']'*) ;; *':'*) echo $1 ;; esac; shift; done | sort
set -- $( batctl o ); while [ -n "$1" ]; do _sanitizer do "$1" mac check && echo "$1"; shift; done | sort | uniq
set -- $( batctl o ); while [ -n "$1" ]; do _sanitizer do "$1" mac check && echo "$1"; shift; done | cut -b12- | sort | uniq

# procd:
# init_debug=4 in cmdline

# Use the source, luke.
# A Ship Is Safe In The Harbor,  But That's Not What Ships Are For
# http://www.youtube.com/watch?v=JNi-2ehPU1U = 'X Farnhams Legende: Kapitel 1'

# check arp-table size:
# http://www.serveradminblog.com/2011/02/neighbour-table-overflow-sysctl-conf-tunning/

# 4900erV1-kueche / jede minute:
usbcore: deregistering interface driver snd-usb-audio
usb_audio: Warning! Unlikely big volume range (=4096), cval->res is probably wrong.
usb_audio: [5] FU [Mic Capture Volume] ch = 1, val = 0/4096/1<6>[16415.356306] usbcore: registered new interface driver snd-usb-audio


# report: r39404
up: 28428.35 load: 0.28 rest: 0.33 0.29 3/41 12489
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
EG-labor-AP
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
up: 28488.06 load: 0.10 rest: 0.27 0.28 2/41 12541
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
EG-labor-AP
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
up: 28548.28 load: 0.39 rest: 0.33 0.30 4/41 12594
procd: watchdog_timeout_cb(37): Ping
procd: instance_exit(203): Instance ubus::instance1 exit with error code 11 after 28572 seconds
procd: instance_exit(203): Instance odhcpd::instance1 exit with error code 11 after 28555 seconds
procd: instance_start(174): Started instance ubus::instance1
procd: instance_exit(203): Instance log::instance1 exit with error code 10 after 28558 seconds
procd: watchdog_timeout_cb(37): Ping
procd: instance_start(174): Started instance odhcpd::instance1
parent: /bin/sh system_crashreboot() reason: 'olsrd_missing'
procd: instance_start(174): Started instance log::instance1
procd: watchdog_timeout_cb(37): Ping
procd: watchdog_timeout_cb(37): Ping
[28596.450000] SysRq : Trigger a crash
[28596.450000] CPU 0 Unable to handle kernel paging request at virtual address 00000000, epc == 801a6f2c, ra == 801a72f4
[28596.450000] Oops[#1]:
[28596.450000] CPU: 0 PID: 12721 Comm: ux4,1390925890, Not tainted 3.10.28 #5



# report: r39139
Wed Jan 15 13:29:37 2014 kern.info kernel: [32900.550000] eth0: link down
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Removing interface eth0.1
Wed Jan 15 13:29:37 2014 kern.debug kernel: [32900.580000] ar71xx: pll_reg 0xb8050014: 0x1a000000
Wed Jan 15 13:29:37 2014 kern.info kernel: [32900.580000] eth0: link up (1000Mbps/Full duplex)
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Removing interface eth0.2
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Writing '0' (was 0) to /proc/sys/net/ipv4/conf/eth0.1/send_redirects
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Writing '0' (was 0) to /proc/sys/net/ipv4/conf/eth0.1/rp_filter
Wed Jan 15 13:29:37 2014 daemon.notice netifd: Interface 'lan' is now up
Wed Jan 15 13:29:37 2014 daemon.notice netifd: Interface 'loopback' is now up
Wed Jan 15 13:29:37 2014 daemon.notice netifd: Interface 'wan' is now up
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Adding interface eth0.1
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Writing '0' (was 0) to /proc/sys/net/ipv4/conf/eth0.2/send_redirects
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Writing '0' (was 0) to /proc/sys/net/ipv4/conf/eth0.2/rp_filter
Wed Jan 15 13:29:37 2014 daemon.info olsrd[2585]: Adding interface eth0.2
Wed Jan 15 13:29:37 2014 daemon.warn 6relayd[2622]: Termination requested by signal.
Wed Jan 15 13:29:37 2014 daemon.warn 6relayd[2622]: Failed to relay to ff02::1%eth0.1 (Cannot assign requested address)
Wed Jan 15 13:29:38 2014 kern.info kernel: [32901.540000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
Wed Jan 15 13:29:38 2014 kern.info kernel: [32901.560000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
Wed Jan 15 13:29:41 2014 daemon.notice netifd: radio0 (16174): Bus error (core dumped)
Wed Jan 15 13:29:41 2014 daemon.notice netifd: radio0 (16174): Device setup failed: HOSTAPD_START_FAILED
Wed Jan 15 13:29:42 2014 daemon.debug olsrd_hotplug: [OK] already_active: 'lan' => 'eth0.1'
Wed Jan 15 13:29:42 2014 daemon.err 6relayd[16266]: Unable to open interface wan6 (No such device)
Wed Jan 15 13:29:42 2014 daemon.debug olsrd_hotplug: [OK] already_active: 'wan' => 'eth0.2'
Wed Jan 15 13:29:42 2014 daemon.info olsrd_hotplug: [OK] ifup: 'loopback' => 'lo'
Wed Jan 15 13:29:42 2014 daemon.debug olsrd_hotplug: [OK] interface 'loopback' => 'lo' not used for olsrd
Wed Jan 15 13:29:55 2014 kern.info kernel: [32917.040000] IPv6: ADDRCONF(NETDEV_UP): wlan0: link is not ready
Wed Jan 15 13:29:55 2014 kern.info kernel: [32919.290000] IPv6: ADDRCONF(NETDEV_CHANGE): wlan0: link becomes ready
Thu Jan 16 07:44:10 2014 authpriv.info dropbear[16426]: Child connection from 10.10.39.25:39313
Thu Jan 16 07:44:13 2014 authpriv.notice dropbear[16426]: Password auth succeeded for 'root' from 10.10.39.25:39313
# -> no coredump found, but coredump of crond found














# batman-adv
# general device config structure:
config device
  option type device-type  # e.g. "macvlan"
  option name virtual-ifname  # e.g. "macvlan0"
  list ifname lower-device  # e.g. "eth0"
  # one or more type specific options, e.g. "option macaddr" for macvlan
 
# example for batadv:
config device
  option type batadv
  option name bat0  # this is the virtual batiface that is to be created
  list ifname wlan0 # these are the devices bat0 should contain
  list ifname wlan1 # ...
  # zero or more options that apply to bat0
 
# example for batadv-vlan:
config device
  option type batadv-vlan
  option name bat0.1  # we want to make a vlan1 on top of bat0
  list ifname bat0 # this is the base device for bat0.1
  # zero or more options that apply to batman vlans




# bluetooth:
# http://h-wrt.com/en/doc/bluetooth
# https://forum.openwrt.org/viewtopic.php?id=22343
# https://forum.openwrt.org/viewtopic.php?id=29977
# http://www.ebay.de/itm/Ampire-BLU100-BLK-AMPIRE-Bluetooth-Aktivlautsprecher-mit-Akku-schwarz-/141131890603?pt=DE_Lautsprecher_Martin&hash=item20dc1dbfab


# ssh $IP wird sofort wieder beendet, das steht dann im log:
Sun Jan  5 10:11:52 2014 authpriv.info dropbear[30105]: Child connection from 192.168.2.1:52923
Sun Jan  5 10:11:59 2014 authpriv.notice dropbear[30105]: Password auth succeeded for 'root' from 192.168.2.1:52923
Sun Jan  5 10:12:00 2014 authpriv.err dropbear[30106]: ioctl(TIOCSCTTY): Input/output error
Sun Jan  5 10:12:00 2014 authpriv.err dropbear[30106]: /dev/pts/0: No such file or directory
Sun Jan  5 10:12:00 2014 authpriv.err dropbear[30106]: open /dev/tty failed - could not set controlling tty: No such device or address




# IRC: list users in channel: /names

# airport graphit:
# http://web.archive.org/web/20031207071236/http://www-hft.ee.tu-berlin.de/~strauman/airport/airport.html
# http://web.archive.org/web/20031211141153/http://www-hft.ee.tu-berlin.de/~strauman/airport/airport_etherboot.html

# loader.c -> reset when halt():
# ./target/linux/ar71xx/image/lzma-loader/src/ar71xx_regs.h
# #define AR71XX_APB_BASE         0x18000000
# #define AR71XX_RESET_BASE       (AR71XX_APB_BASE + 0x00060000)
#
 #define AR71XX_RESET_REG_RESET_MODULE           0x24
 #define AR913X_RESET_REG_RESET_MODULE           0x1c
 #define AR724X_RESET_REG_RESET_MODULE           0x1c
 #define AR933X_RESET_REG_RESET_MODULE           0x1c
 #define AR934X_RESET_REG_RESET_MODULE           0x1c
#
 #define AR71XX_RESET_FULL_CHIP          BIT(24)
 #define AR934X_RESET_FULL_CHIP          BIT(24)
# 
# target/linux/ar71xx/image/lzma-loader/src/loader.c
# arch/mips/include/asm/mach-ath79/ath79.h
# -> ath79_device_reset_set -> ath79_reset_wr(unsigned reg, u32 val) -> 
#  __raw_readl(ath79_reset_base + reg);
#  __raw_writel(val, ath79_reset_base + reg);


# flashbank:
#  1. brcm47xx = wrt54g + wap?
#  2. brcm63xx = speedW500V/Targa-WR-500-VoIP
#  3. ar71xx = tplink 1043nd + 841nd + Bullet 5M
#  4. atheros = ar231x = ar2315-fonera + 5312-nanostation5 + dlink-dir300
#  5. au1000 = meshcube/tmobilebox
#  6. ar7 = alte fritzbox?
#  7. mpc85xx = 4900er
#  8. x86 = Soekris NET
#  9. kirkwood = NAS/seagate
# 10. imx23/mx2 = chumbyOne
# 11. s3c24xx   = openmoko (removed @34767)
# 12. Marvell/Intel PXA2xx/ARM   = zipit
# 13. omap4 = pandaboard
# 14. brcm2708 = raspberryPi
# 15. Cobalt = SunCobalt-RaQ4i
# 16. rb532 = routerboard/boltenhagen
# 17. gemini = Wilibox WBD-111 (kaufen)
# 18. arm5l = WiFiSD-Card
# 19. sparc = SUN Enterprise 250 UltraSparc
# 20. imx21 = VP6500

# empfang schlechter: txpower?: iw dev wlan0 set txpower fixed 2300
# vorher: r35300
root@hauptstrasse52-dach:~ n
Table: Links
Local IP	Remote IP	Hyst.	LQ	NLQ	Cost
10.10.36.1	10.10.2.1	0.00	0.701	0.364	3.905	
10.10.36.25	10.10.225.33	0.00	1.000	1.000	0.100		# OK
10.10.36.1	10.10.157.1	0.00	0.607	0.454	3.616	
10.10.36.1	10.10.12.1	0.00	0.592	0.753	2.242		# OK
10.10.36.1	10.10.17.1	0.00	0.306	0.000	INFINITE	
10.10.36.1	10.10.4.1	0.00	0.497	0.713	2.813	
10.10.36.1	10.10.22.1	0.00	0.000	0.000	INFINITE	
# nachher: r39139
root@hauptstrasse52-dach:~ n
Table: Links
Local IP        Remote IP       Hyst.   LQ      NLQ     Cost
10.10.36.1      10.10.2.1       0.00    0.701   0.000   INFINITE
10.10.36.25     10.10.225.33    0.00    1.000   1.000   0.100   	# OK
10.10.36.1      10.10.157.1     0.00    0.701   0.000   INFINITE
10.10.36.1      10.10.12.1      0.00    0.514   0.725   2.683   	# OK (wenig schlechter)
10.10.36.1      10.10.17.1      0.00    0.074   0.000   INFINITE
10.10.36.1      10.10.4.1       0.00    0.211   0.000   INFINITE
10.10.36.1      10.10.22.1      0.00    0.000   0.000   INFINITE
# spaeter nochmal / r39139:
root@hauptstrasse52-dach:~ n
Table: Links
Local IP        Remote IP       Hyst.   LQ      NLQ     Cost
10.10.36.1      10.10.2.1       0.00    0.804   0.259   4.806   	# etwas schlechter
10.10.36.25     10.10.225.33    0.00    1.000   1.000   0.100		# OK
                10.10.157.1
10.10.36.1      10.10.12.1      0.00    0.713   0.776   1.804		# OK
                10.10.17.1
10.10.36.1      10.10.4.1       0.00    0.031   0.717   INFINITE
                10.10.22.1
10.10.36.1      10.10.72.1      0.00    0.682   0.271   5.416   


# RAM/memory-fragmentation:
# echo m > /proc/sysrq-trigger
# http://stackoverflow.com/questions/4863707/how-to-see-linux-view-of-the-ram-in-order-to-determinate-the-fragmentation
#
# maybe set 'CONFIG_COMPACTION', so we can use 'echo 1 >/proc/sys/vm/compact_memory'

# memleak global vars?
# http://landley.net/notes-2006.html#24-10-2006

# be strict:
# https://sipb.mit.edu/doc/safe-shell/
# set -e

# styleguide?
# http://google-styleguide.googlecode.com/svn/trunk/shell.xml

# how does this work, maybe join?: http://oops.kernel.org/


TODO-important:
### remove old /tmp/vds*
# ejbw: force WAN olsr on 50
# checkout wifi-greenfield: https://dev.openwrt.org/ticket/16667#comment:6 https://dev.openwrt.org/ticket/16667#comment:8
# implement PPP-Max-Payload: https://dev.openwrt.org/ticket/16805
# remove db_lock when crond-lock/scheduler-log is removed
# OLSR-prio: https://github.com/zioproto/fairvpn/wiki/ShapingNotes
# einspeiser muss propagieren, das internet ausgefallen ist (satama!)
# beacon-rate bei longshot-adhoc? HT = NOHT,HT20,HT40 - obwohl chanbw=5
# wenn bei user_add() festgestellt wird, mac gibt es schon: abmelden und neu anmelden. wenn IP = 169.254.216.113 -> sonderbehandlung
# usb-power off: 703n: echo 0 >/sys/class/gpio/gpio8/value
# set custom X-HTTP header for weblogin output
# alle 'case $CONFIG_PROFILE in' nach override_uci_vars

# solve dhcp-with-many-IP's to the same client-issue: http://lists.thekelleys.org.uk/pipermail/dnsmasq-discuss/2011q2/005041.html
root@EG-steinmetzBuero:~ ip neigh | grep 00:23:8b:a5:18:dc
fe80::b17f:c521:1487:d871 dev eth0.1 lladdr 00:23:8b:a5:18:dc STALE
10.63.11.113 dev eth0.1 lladdr 00:23:8b:a5:18:dc STALE
10.63.11.112 dev eth0.1 lladdr 00:23:8b:a5:18:dc STALE
10.63.11.111 dev eth0.1 lladdr 00:23:8b:a5:18:dc STALE
169.254.216.113 dev eth0.1 lladdr 00:23:8b:a5:18:dc STALE

#
#
# olsr-status: show SNR for missing nodes
# remove HT40- or HT40+ calls
# refresh hotplug_without_exit-patches
# rework khubd-blocked-detector
# how to avoid: user_add() when user is a router? -> olsr_fixed_arp?
# everywhere: use 'grep -m1' instead of 'grep bla | head -n1' (check which commit enabled this option)
# enforce wifi-speedtest via linklocal IPv6 / forbid route switching
# switch: check all supported models and remove legacy code
# lizst28: when etx_ff, remove 'Mode ether/mesh'
# status.sh: raus/rein: broadcast/echter datenverkehr trennen
# is it portable? echo $((try++))
# loader: can we use $@ = quoted $* instead of $1 $2 $n?
# nightly_reboot wenn eigentlich overup?
# include sorttable.js -> google_closure -> CrunchMe = http://www.bitsnbites.eu/?p=112 -> pngout = http://advsys.net/ken/utils.htm -> 2.8k
# status.sh: ip->32bit int for sorting
# status.sh: highlight each 2nd row with CSS and same for numbering first row
### report to sql: >X gig-users
### satama/fparkssee/marinapark: SSID=wartung, wenn einpseiser fehlt
### sehr oft index_gen?
### - always 'read' = 'read -r'? http://pubs.opengroup.org/onlinepubs/9699919799/utilities/read.html#tag_20_109
# build: support for Davicom DM9601 USB Ethernet
# - 0fe6:9700 Kontron (Industrial Computer Source / ICS Advent) DM9601 Fast Ethernet Adapter
# = dm9601,cdc_ether + usbnet
# = DEFAULT_kmod-usb-net-dm9601-ether
### - switch: kueche/UFO: TP-LINK TL-WR841N/ND v7
# - check each function during scheduler_run/debug-mode with: set | grep ^[a-z]
### watch coredump: only restart daemons ONCE + show all dumps first
# usb2ethernet: LogiLink: 9710:7830 MosChip Semiconductor MCS7830 10/100 Mbps Ethernet adapter
# rb532: ath5k: http://patchwork.linux-mips.org/patch/4087/
# 148f:3070 Ralink Technology, Corp. RT2870/RT3070 Wireless Adapter -> dodge/garage = Intellinet wireless 150N usb-adapter rev. 3.04
###### instead of use 'test -e ' -> ls -1 "/var/www/networks/gnm/settings/"*.jpg 2>/dev/null >/dev/null
### join: _net_ip_reachable + _netfilter_reachable()
### via netcat: https://github.com/weimarnetz/openwifimap-api/blob/master/API.md
### schoeneck: etiketten/format
### generic: max,min,avg,leaving_border and use for: mcast-rate, routes-counter etc.
# remove all calls of 'exit'
# kalua-parser fails if:  grep ' # mac: ' $file (dont cut off '#' when not a comment)
# LANADR is NOT always there, e.g. meshcube + no wire -> error during deepcheck of webserver -> use new var 'force_link' from r40456
# build-server: export HOSTNAME
# - coredump: udhcpc -> ifup wan, when dhcp
# - 192.168.$NODENUMBER.x = $ROAMING_IP		-> 172.16.0.0/14 = 172.16.0.1 ... 172.19.255.254
# - firmware-update: dont delete /tmp/.uci
# - no uci_commit during new_user()@GUI
# monitoring: show red if pubkey not thrusted
### iface_ifdown() cron hangs, restarting 3mins before reboot
### $count in coredump wird falsch gezaehlt
### add olsr-watchdog-plugin to cron.minutely?
# - liszt28: add '10.63.2.34' to known hosts
# - userdb: einmaltickets -> automatisches eintragen der mac
# - new dyndns or: '$IP bwireless.mooo.com' in '/etc/local.hosts' + update -> eigener dyndns-dienst: haus12.spbansin.intercity-vpn.de
# - switch_show() defekter switch node12? -> retry nur wenn es schonmal ging
# - ueberlange moni-meldungen mit minimal-heartbeat abschliessen oder keine OK speichern
# - olsr-control counter: do i send out myself?
# - count traffic in same network? e.g. NAS<->MEDION
### - amalienhof: strange situation2: olsr-nexthop != routing-table nexthop: 10.10.80.1/172.20.1.1
### - amalienhof: wireless.@wifi-iface[0].encryption=psk2 wireless.@wifi-iface[0].key=31122014
### - move hotplug-wan-security to netfilter
### - move IP/WAN-stuff into private /tmp/apply_
### - /tmp/user_vdsOK - only accept if not older than X? (against nodes with long uptime)
# - http://twitter.com/#!/Rehungen ?
# - make usage of 'connlimit'?
# - 'pidof dnsmasq' shows also pid of 'fakedns'
# - make sure rrd-update makes no spikes?
### - ejbw: fremd-sms nicht mit "WLAN-SYSTEM" verschicken
# - cupandcoffee: sms-mode aktivieren?
### - Feb 25 04:10:11 ' [up 86191s 3776512 bytes free] /etc/dhcp-script.d/10dhcpscript [daemon.alert] watch_cron() cron died, restarting
# - rework 4900er lan-MAC: https://dev.openwrt.org/ticket/14714#comment:5
### - GeraetX ping der reihenfolge nach immer wieder alle durch, fuer _schnelleres_ monitoring.
      - extra cronjob
      - direkte meldung an monitoring-server
      - evtl. auch ICMP-filewall-dings dann muss es kein extra cronjob sein sondern man schaut nur was ausbleibt.
      - am besten das geraet, wo auch sql/ticket-meldungen hingehen? -> anlegen der ICMP-regeln nach IP
      - Ziel: Monitoring soll schneller Rot zeigen
      - jeder node muss notfallanweisung bereitstellen: e.g. nachbar muss sich mit IP xy verbinden und Z ausfuehren (e.g. wget)
      - was ist wenn MONITORING-node neustartet? Anweisungs/IP-liste muss erhalten bleiben
      - aus abhängigkeitsliste kann auch gleich updateliste erstellt werden.
#
# apply_profile: ejbw50/master: allow WAN-olsr
# apply_profile: community.XY
#
# - ibfleesensee:
#   - tweak dnsmasq-hotplug
#   - disable kmodules: ip6tables + ppp + ulog + usbcommon/core + ath9k
#   - vlan-doku: z111=105, z206=198:ZG3/7, z315=125:EG3/17, z411=220:ZG1/11, z512=152:2OG1/12, z442=150, z542=183
# - reboot_nightly und inet tot? -> speichern und gleich wieder SSID wechseln nach boot
### nexthop regelmaessig bauen/minimoni (fuer batman auch?)
### monitoring: exit wegen [ -z $WIFIDEV ] ?
# - new_build:
#   - add info.txt what means e.g. Standard
#   - add info.txt about buildtime for hole build + each target?
# - shaping: $i + $j -> classid_down/up
# - dont send 'realcrash' to master, if 'watchdog' was the reason
# - reboot/crash ankuendigen durch netmsg $LAN - damit umliegende keinen 'switch_error' werfen
# - crashreboot for: scheduling reboot - reason: 'wifi_watch_phy_restarts: no wifi clients, rebooting'
# - inet_seems_stable() check real internet from time to time too
# - pingplotter in cron.minutely or RRD
#   - DSLer: ping ins internet
#   - ansonsten "ping -c1" auf nexthop. wenn latenz hoch, ping -c 10 + durchschnitt
# - monitoring: rebootknopf?
# - after DMA erro: cat /sys/kernel/debug/ieee80211/phy*/ath9k/interrupt - https://dev.openwrt.org/ticket/11862#comment:187
# - disable 5ghz on non-batman nodes, till we fix ip-system/dhcp
#
# - watch_lowmem_freemem() if simplemesh, keep everything up till hna-slave was there
# - lowmem: only end netifd/ubus after recent uptime/when hna4-slave-question was
#
# - enable wlan-dhcp + enable on correct interface e.g. wlanRADIO1 (former batman-node)
# - check all 'set -- ' if there is globbing involved, maybe do set -f; set -- $bla; set +f
# - count 'events' and show this number in monitoring (e.g. all 'alerts'?)
# - global VAR for $STORAGE_DIR on flash, e.g. STORAGE_DIR='/www'
# - own history for reboot + switch
# - update_pmu/brcm47xx?
# - check all rcS-tasks for 15sec length -> $SCHEDULER  and remove anti-hang-hacks with rTODAY
# - portfw doesnt go through shaping?
# - mail_resend: nen haufen leichen... readable? -> r99 -> netfilter copy over own pub-ip
# - webcam: motion: snapshot always 60 sec, but upload dont use if there was an event and when no event, adjust according to event-action
# - webcam: store event.log + upload
# - server/monitoring: support for 'autohide' (lisztwe)
# - liszt28: echo 2 >/sys/kernel/debug/mips/unaligned_action
# - splash: check error-code: 511?
# - batman: raise MTU on adhoc - 1560?
# - batman-gwl: dynamic lease, renew every X mins -> dnsmasq reload
# - inet_seems_stable auf inet_offer schlaegt X mal fehl, irgendwie nodes in wartungsmodus versetzen
# - http/ssl-certs: gueltigkeit! -> immer neu generieren?
# - warum kann es mehrere scp-prozesse geben?
# - get shaping/speed from ticket
# - webcam: better sort: img_889.ffmpeg.jpg -> img_88.ffmpeg.jpg
# - if planned overload: fire watch_monitoring()
# - boltenhagendh: stopwatch_stop(): task 'index_gen' lasts 5677.82 seconds (1h 34min 37sec) - wirklich 5 uhr starten? -> besser 2uhr
# - lockfile-remove: show last job which was invoked
# - update_pmu: no_space_left -> watch_flash + prozentanzeige des verlaufs + alphabetische reihenfolge?
# - kein SCP wenn schon scp laeuft/haengt
# - r2: empaengt noch, aber sendet nicht mehr. olsr-check. irgendwie automatisch -> groesse der routentabelle loggen
# - rrd_show wirklich alle 15min?
# - solve scheduler prob: A="logger 'hallo'"; $A -> the call will be: logger "'hallo'"
# - https://bbs.archlinux.org/viewtopic.php?pid=1168667 -> nf_conntrack: automatic helper assignment is deprecated and it will be removed soon.
# - crashdump: disable on lowmem-devices -> otherwise oom happens during crashdump-output
# - crashdump: store in "small" tmpfs, otherwise simultanious crashs can eat up too much mem
# - log pppoe-con losts/downtime via dyndns-hotplug
# - kein firmware-update wenn vor ca. 24h ein neustart war (zeitschaltuhr)
# - dhcp-old -> SCHEDULER
# - taskplanner: dont run every minute, only when low load but build a todo-time-file
# - batman: check if dhcp-users are logged in, if not: splash
# - detect ubusd pid-change
# - wenn 192.168.0.61 -> 192.168.222.1 -> 192.168.76.1 -> olsr-netz, dann nat oder HNA
# - taskplanner: die meisten entscheidungen koennen bei cron.startup getroffen werden
# - taskplanner: include into cron-ram-copy + kein loader mehr noetig
# - 1043nd: watchdog: https://dev.openwrt.org/ticket/12121
# - ping IC: remeber last and only ping once round-robin + use: -W 3?
# - remove 'sleep 30' from netfilter-startup -> hotplug
# - hangs: rmmod xt_tcpudp + rmmod xt_CT + iptable_raw + ipv6
# - WTF: warn netifd: You have delegated IPv6-prefixes but haven't assigned them to any interface. Did you forget to set option ip6assign on your lan-interfaces?
# - do something against stack-corruption/overflow:
#   - http://stackoverflow.com/questions/11861762/stack-corruption-in-c
#   - http://stackoverflow.com/questions/1258550/why-should-you-use-strncpy-instead-of-strcpy
# - logger: send ALL alerts to central server, e.g. crashs
# - cron = procd-service
# - scp_do()
# - coredump: autoupload/remove
# - reboot_safe() fix REASON and fix autorun-call
# - db_backup() calc size needed?
# - cron.check_inet_gw: dont accept "# ignore localhost", when not inet-offer
# - really disable batman if not needed (remove aliases too + changed macs)
# - askconsole: activate when not LOWMEM
# - pmu() too often?
# - check: endlich insmod mit parametern?
# - monitoring: show 'error watch_dns_resolution' -> IFA126
# - schoeneck: 126 = '3e:75:11:b1:02:61'?
#   root@HausA-KellerZimmerEDV:~ batctl tr 192.168.126.1
#   traceroute to 192.168.126.1 (3e:75:11:b1:02:61), 50 hops max, 20 byte packets
# - mailstash = alert?
# - zram via hotplug?: Fri Jan  3 11:34:11 UTC 2014 1: block ACTION: add DEVPATH: /devices/virtual/block/zram0 INTERFACE:  DEVICE:
# - hotplug: cron running?: simple check if cron.minutely was active?
#   - pidof S51crond_fff+  (can hang)
#   - in /sbin/hotplug-call:
#     - echo "$(date) 1: $1 ACTION: $ACTION DEVPATH: $DEVPATH INTERFACE: $INTERFACE DEVICE: $DEVICE" >/dev/console
#     - echo "$(date) 1: $1 ACTION: $ACTION DEVPATH: $DEVPATH INTERFACE: $INTERFACE DEVICE: $DEVICE" >>/tmp/HOTPLUG
#   - in /lib/netifd/dhcpv6.script
#     - echo "$(date) 1: $1 2: $2 3: $3" >>/tmp/LOG
#   - dyndns: ACTION=ifup INTERFACE=wan DEVICE=pppoe-wan $1 = 'iface'
# wget-loop firmware: _watch pppoe/dns in each cycle
#
#
# make use of: ubus call network.device status (we have now: ubus call network.interface.lan status)
# - Link auf interne Ticket-DB vom Rezeptionsrechner: portfw
# batctl trace -> to each laptop from master during assoc
#
# build: all kalua-tweaks via subcall
# DIR300: swconfig eth0: 4 gap 3 2 1 0
# dnsmasq: force interface: DNSMASQ_INTERFACE is wrong on 222: lan -> wlan1-1
# batman: BLA - only activate when needed, it makes extra traffic
# marinapark: HNA/MP-dsler: missing? -> wartungsmodus
# make use of moni-wiredneighs for sorting (grouping real partners)
# radioX disabled? name SSID = off
# profiling for each function via switch?
# speedtest upload via backquestion
# _log view 2h
# viele reboots? -> disable wireless at bootup
# detect bitcoind-traffic
# no internet? bit firmware-upgrade needs hash-download, even when /tmp/fw exists
# OLSR-LAN-strange: 	iptables -I INPUT -p udp --dport 698 -i $LANDEV ! -s $LANADR
#			iptables -nxvL INPUT;sleep 60;iptables -nxvL INPUT
#			-> strange = e.g.: 37 ... 22 ... 20 packets/min
#			-> good =    e.g.: 350 ... 340 ... 353 packets/min	# hotello-B01
#
# build:
# bastian: kalua/openwrt-build/build.sh: apply_symbol() ERROR during 'git am'
# previous rebase directory /home/bastian/openwrt/.git/rebase-apply still exists but mbox given.
# laptops: batctl transglobal | while read line; do set -- $line; echo $2; done | sort | uniq | wc -l
# tool: show traffic/tc from a single mac
# make mysleep() with internal command : -> use it when critical

# teredo? http://www.heise.de/newsticker/meldung/AVM-aktualisiert-Fritz-Box-7490-Firmware-kleiner-Rueckschritt-inbegriffen-2060590.html
# -> miredo!

# idee: youtube ueber tunnel:
# https://forum.openwrt.org/viewtopic.php?pid=207497#p207497


# dyndns:
# /etc/hotplug.d/iface/99-ifup-wan
# ACTION=ifup + INTERFACE=wan ? -> dyndns

# Tue Dec  3 10:04:06 2013 daemon.notice netifd: cfg114d8f (25410): ./batadv.sh: eval: line 1: can't create /sys/class/net/pppoe-wan/batman_adv/mesh_iface: nonexistent directory
# -> no batman-WAN, if pppoe or DHCP

# sleep for reboots with real builtins?
# http://stackoverflow.com/questions/3224878/what-is-the-purpose-of-the-colon-gnu-bash-builtin

# idee: vermeiden von neustart/switch_check: vorher abmelden bei nachbarn


# idea for kalua-global-vars:
# OPENWRT_REVISION='12345'

# idee:
# opkg install kmod-ipt-filter iptables-mod-filter
# iptables -A INPUT   -p udp --dport 53 -m string --algo bm --string "facebook.com"


# ping6 in busybox lack '-L' so it returns loopback: ping6 -c 1 ff02::1%${LANDEV:-eth0}
# also: -p payload: http://superuser.com/questions/569445/which-ping-sends-icmp-echo-as-payload
# timestamp: http://sd.wareonearth.com/~phil/net/ping/

# install htop?

# traffic erst ab X mb shapen: traffic_control_autoapply_speedsuggest()

# iptables -I FORWARD -m ttl --ttl-eq 1

# cgminer: rrd: cgminer-api stats | grep -i temp -> temp1 + temp2 + Vcc1 + Vcc2 + Vmain + Speed + HW-errors

# _log do Ausfall daemon sms "J4-Lueftungskeller-T11 (auf Serverschrank) neustarten"

# research: http://hack-it.org/index.php?title=Mdk3
# MDK is a proof-of-concept tool to exploit common IEEE 802.11 protocol weaknesses.


# disable/enable kmodules, if not needed / needed:
# - ppp
# - wifi
# - batman
# - netfilter

# liszt28:
# check if on *_ap all wifi-clients are in 'batctl translocal'


# 4900er: flash_size incorrect


# new build:
# timer 'prepare'
# timer 'make'

# shell: for octet in ${mac//[\.:-]/ }
# shell: octet="${octet:0:2} ${octet:2:2}"

# idee:
# failsafe via net aktivieren:
# patch failsafe: ping 6.6.6.6? -> ja + meldung
# patch: package/base-files/files/lib/preinit/30_failsafe_wait


# pruefen:
# gegen netrate_ratelimit:
# https://lists.openwrt.org/pipermail/openwrt-devel/2013-November/022559.html
# net.ipv4.tcp_max_syn_backlog = 2048                                                                                                                          # net.ipv4.tcp_synack_retries = 3    

# tuberlin:
# config httpsproxy                 
#        option enabled 1       
#        option ipaddr  auto     # auto = first LAN-DHCP-lease | <ipaddress> OR via FORM_DATA
# cookie support?

# apply_profile:
# - ejbw: WAN+LAN-Olsr auf Einspeiser
# - ejbw: RF bssid?


# pruefen: https://github.com/schuza/openvswitch + http://openvswitch.org/

# konzept: pingtest/watchdog fuer netio230b selber implementieren und per netcat port-reset ausloesen
# - gnm + dhsylt + frenzel + schoeneck
# http://wiki.linuxonlinehelp.de/index.php/Netio-230b
# - ping auf station X, raise counter till Y
# - action = netcat ...
# - 3 werte:
# geht nur, wenn 2 geraete an steckdose sind...


# liszt28: 5ghz: mcast = 1.000 ???

# problem loesen das im monitoring manchmal richtige und manchmal batman-mac steht

# detect non-working scp to monitoring-server and show in monitoring + dont try again?

# interesting batman/dnsmasq-trick: http://lists.thekelleys.org.uk/pipermail/dnsmasq-discuss/2013q4/007750.html

# http://stackoverflow.com/questions/15372011/configuring-arp-age-timeout
# make use of '/proc/sys/net/ipv4/neigh/eth0.2/gc_stale_time' ?

# LOWMEM: erst in S95done wird '/tmp/CRON_IS_CAREFUL' sichtbar gemacht

# apply_profile.code kann auf /tmp/loader aufbauen

# use ulogd2 / ulogd_output_OPRINT.sh : http://kangran.su/~nnz/pub/nf-doc/ulogd2/i
# or ulogd_output_SQLITE3.so

# LOWMEM:
# - no dhcp on WAN, when apply_profile exists
# - no ntp(d) , when apply_profile exists / /etc/init.d/sysntpd
# - no sleep 300 in S70prep , when apply_profile exists
# - no S69 when apply_profile exists
# - no 6relayd , when apply_profile exists
# - cron.konzept ueberdenken
# - webserver beenden/dropbear starten wenn 'fresh' ohne profile-definitionen
# - wenn nicht fresh, wifi down
# - 15min-cronjob: uhttpd stop

# fix missing "wan/inet-offer" mode in monitoring

# maybe: monitoring: send /proc/net/dev -> rx/tx bytes/packets -> rewrite wifi_tx_and_rx()
# maybe: batman-trace/nextIF: debug-output, e.g. debug="LAN= WAN=$WANDEV was: $nexthop-dev"

# db: nach aufräumen 'eval' test jeder zeile

# rewrite cron-startup

# reverse_ssh-tunnel: make it forceable even without inet-offer (b01/4)

# ubus call network.device status '{ "name": "anygw" }'

# audioplayer: check somehow if '/dev/dsp' is used (hanging wget/madplay)

# build: support for including all mypackages* for specific network

# why 2 empty lines at top of cron.minutely?

# firmware_wget() -> respect bigbrother/usbaudio

# netfilter: check_deps()

# better locking: http://wiki.bash-hackers.org/howto/mutex
# mkdir /var/lock/mytask || exit 1
# rm -R /var/lock/mytask

# rrd: ping/latency to nexthop:
# - ping -c 60 $IP
# - 60 packets transmitted, 60 packets received, 0% packet loss
# - round-trip min/avg/max = 2.314/27.849/390.571 ms
# draw: loss/avg/max/metric?

# rrd: forks (each time cron.minutely is called $$)
# rrd: respect phy/phy1/phy2 in one graph - just "change" nulllinie + opaque colors?
# rrd: gateway-node: fat line, change color for each GW, show GWs in legend
# rrd: include add() into CRON_IS_CAREFUL and use the rest via kalua
# rrd: add total-counters: CDEF:ds0total=ds0,$(uptime_sec),*    +    GPRINT:ds0total:AVERAGE:"Total\:%lf"
# rrd: repair no_forward
# rrd: wc -l /tmp/OLSR/ROUTING_TABLE_MAIN *** oder *** batctl originators | wc -l
# rrd: longshot-faker/enforcer for nexthop (dhsylt|rehungen_feld)
# rrd: load: when >1.00 ONLY rrd_load, all other values dont set/collect (um wirklich LOAD zu sehen)
# rrd: longshot/all-mode: show in legend and show rx/tx OR wifi2lan OR lan2lan
# rrd:
#   - bei setup() datei X anlegen.
#   - die ersten 30 mal '#' nach X appenden.
#   - solange X existiert wird default_gw bestimmt.
#   - wenn defgw = wifi, dann 'MAC' bestimmen
#   - von dieser MAC rx/tx plotten
#   - wenn sich MAC nicht aendert, wird /tmp/RRD_MAC geschrieben (und weiterhin genommen)
# longshot-detector: only when first 30mins = longshot -> maybe if wifi-gateway = fix? (f36dach -> schreibtisch)


# USERDB-copy download von node der es nicht hat? -> kein OK, aber was anderes...

# hohe load? rm /tmp/USERDB*.gz ? oder einfach loeschen wenn es ne weile nicht angefasst wurde

# uci-essential test / cron.minutely: 1st check during cron.startup, otherwise test for 'true'

# test: b0rken inet -> change essid in batman-mode: it works!? -> deactivate reboot

# reboot-detector: in own file /www/REBOOTS ? und bei year = 1970 beim ersten ntp in diesem file korrigieren

# pubssh.ipk -> auf batman ip's rein 192.168.x.1

# beim abliefern von cron.add-user... kommandos uebergeben? bequemes ausfuehren von befehlen auf allen routern?

# debug high load on r99: http://stackoverflow.com/questions/10846747/origin-of-a-kworker-thread

# git grep reboot_safe -> ordentliche reasons eintragen

# cron: crashreboot.file jede minute schreiben und ausfuehren mit 'reason=bla; . /tmp/CRASHREBOOT'

# check: http://rooter.kyberian.net/tag/adhoc/

# USERDB: support for shorthash (first 8 bytes?): db_hash() echo -n "bla" | md5sum | cut -b1-8

# check: shaper: http://openwrt.pl/doku.php/zastosowania:pasmo

# mail: ticket-tar: besserer name + nicht in /tmp

# high-load? wifi down! -> immernoch? reboot, sonst wifi up

# speedtest/testdownload zu jedem neuen gateway

# die 3 haeufigsten Gateways im monitoring zeigen (prozentualer anteil)

# patch: procd: show module-loading on /dev/console
# patch: procd: minicron

# ejbw: 100: lan_masq needed?

# instead grep JSON: . /usr/share/libubox/jshn.sh; json_load "$(devstatus $WANDEV)"; json_get_var var1 speed; echo $var1

# add macvlan via netifd: http://nbd.name/gitweb.cgi?p=luci2/netifd.git;a=commitdiff;h=5dd87fd8ad3a42c71d90a8fecc893af973e552bf;hp=9585227f1141d9da5a3186df5e10c4521e65083e


# debug in cron.minutley:
# high load? maye loop for more console output?

# build a kernel with 'CONFIG_PERF_EVENTS=y' and use 'perf top'

# bat-tr: node(weblogin_authserver)->192.168.$node.1

# USERDB-copy: from nexthop

# scp: test auf monitoring-server bei _watch_random_node_id()/registrator?

# pruefen:
# root@liszt28-hybrid--222:~ _net ip2dev 192.168.222.61
# br-mybridge
# root@liszt28-hybrid--222:~ ip n|fgrep 192.168.222.61
# 192.168.222.61 dev br-mybridge lladdr 00:21:6a:32:7c:1c PERMANENT
# 192.168.222.61 dev gateway0 lladdr 00:21:6a:32:7c:1c PERMANENT



# cisco-esque

# memtest:
# keine pruefung, wenn crash - ausser bei speziellem crash: nur welcher? (sysrq wird auch bei ALERT benutzt/gebraucht)
# -> "neightly_reboot_crash"
# ungeplanter reboot? -> kein netfilter (ausser NAT wenn inet_offer)

# find a way to check for patched regdb, maybe klog?
# see: apply_profile.code

# check:
# monitors the netfilter conntrack table to help tune the max limit one needs to set:
# https://github.com/QueuingKoala/wrt-nflog
# https://github.com/QueuingKoala/wrt-iptables

# batman: revert change for 'batctl if':
# scp root@intercity-vpn.de:/var/www/files/openwrt/0001-batman-adv-avoid-openwrt_metadata_stripping feeds/routing/batman-adv/patches
# eigentlich:
# cd feeds/routing
# git revert a8e21bf882e1815023b224081843248030f1ad18


# only signal dnsmasq, if something relevant has changed

# git checkout -b feature_abc

# random:
# dd if=/dev/urandom count=1 2> /dev/null | md5sum
# grep -m1 -ao '[0-9]' /dev/urandom
# grep -m1 -ao '[0-1][0-2][0-9]' /dev/urandom

# wificheck: rrd
# wificheck: border muss abhängig sein von avg. bei 20 frames/sec sind 50% was anderes als bei 200 f/s
# wificheck: avg_p_change > border? ...ping 1 or 2 neighs, of not possible: wifi_restart?
# wificheck: max und min festhalten

# wget() convert pause = pause between no data is transfered?

# parse version2date from: https://www.kernel.org/pub/linux/kernel/v3.x/
# http://landley.net/writing/git-bisect-howto.html


# ticketmails: hinweis auf NICHT antworten und ReplyTo: correct setzen?

# URL_PATCH="http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/patch/?id=9c9b415c50bc298ac61412dff856eae2f54889ee"
# URL_PATCH="http://www.intercity-vpn.de/files/openwrt/memtest.patch"
# wget -O target/linux/ar71xx/patches-3.10/$NAME.patch
# make V=99 target/linux/{clean,compile}; make

# olsr-packets on LAN, but no neigh? restart daemon

# rrd: better way for check: longshot? -> if not, hide line

# /www/mybestneigh anlegen und uhrzeit von dort stellen
# wenn reboot NICHT geplant war, logging (kein crash, kein nightly reboot, kein safe_reboot)
# wenn reboot NICHT geplant war: netfilter off?

# reserving runtime for longrunning tasks must include a max (count down)

# ssh-key.ipk
# optimize
# add batman-ips

# batman-adv:
# parse "station dump" and "batctl o" for neigh-list and gateway...
# nexthop?

# monitoring/doku: energieverbrauch errechnen?

# batman/openwrt-fix (module-optimization)

# add wifi and ethernet-performance
# http://wiki.openwrt.org/doc/howto/performance


# mkmime:
CONFIG_BUSYBOX_CONFIG_MAKEMIME=y
CONFIG_BUSYBOX_CONFIG_FEATURE_MIME_CHARSET="n"


# support for http://wireless.kernel.org/en/users/Documentation/acs

# flash 1043nd:
# erase 0xbf020000 +7c0000; tftpboot 0x81000000 code.bin; cp.b 0x81000000 0xbf020000 0x7c0000; bootm 0xbf020000

# batman: gateway muss immer selber adresse sein, aber es muss eine art metric geben wie die gleiche adresse NOCH liegt?
# also: was passiert bei reboot: es soll weitergehen. das geht nur wenn GW auch erreichbar ist...

# automatically collect bootloader-hashs of 1043nd

# screen: safe scrollbackbuffer to file: CTRL-A : hardcopy -h <filename>
# screen: raise scrollbackbuffer size:   CTRL-A : scrollback 10000 <enter>

# memtest:
# http://lkml.indiana.edu/hypermail/linux/kernel/1211.1/00711.html
# https://lkml.org/lkml/2012/11/9/129
#
# memtest early clock:
# http://lists.linaro.org/pipermail/linaro-dev/2013-August/016542.html
# http://lwn.net/Articles/460432/

# HTB: quantum of class 10001 is big. Consider r2q change.
# http://www.linksysinfo.org/index.php?threads/tomato-mod-1-20-8000.26621/page-3#post-125507

# network.mybridge.netmask_dhcpcalc -> muss zu dhcp

# update-reihenfolge anhand hopcount festlegen

# cupandcoffee: profile anlegen / flashen

# olympia: fwupdate + roaming

# use wifi-watchdog:
# /sys/kernel/debug/ieee80211/phy0/statistics/multicast_received_frame_count

# If you are running out of memory (which I suspect you are) the following 3 lines in /etc/sysctl.conf will probably help to prevent that.
# vm.vfs_cache_pressure=1000
# vm.min_free_kbytes=4099
# vm.swappiness=0


# lowmem: nocron_during_client_action: at least send minimal-monitoring
# maybe same abstraction like routers which needs "proof of work" (too much reboots)


# detect suddenly lost auf neighs:
# best would be: average olsr-packets/interval on each interface:
# log/action: if something goes crazy

root@HausA-Wintergarten-MESH:~ n
Table: Links
Local IP        Remote IP       Hyst.   LQ      NLQ     Cost
10.10.211.1     10.10.132.1     0.00    0.897   0.646   1.721   
10.10.211.1     10.10.234.1     0.00    1.000   0.948   1.054   
10.10.211.1     10.10.143.1     0.00    0.948   0.815   1.291   
10.10.211.1     10.10.138.1     0.00    0.901   0.952   1.163   
10.10.211.1     10.10.147.1     0.00    0.948   0.808   1.304   
10.10.211.1     10.10.153.1     0.00    0.854   0.815   1.434   
10.10.211.1     10.10.210.1     0.00    0.948   0.497   2.115   
10.10.211.1     10.10.157.1     0.00    0.765   0.866   1.509   
10.10.211.1     10.10.140.1     0.00    0.701   0.780   1.825   
10.10.211.1     10.10.136.1     0.00    0.736   0.862   1.571   
10.10.211.1     10.10.134.1     0.00    0.619   0.909   1.773   

root@HausA-Wintergarten-MESH:~ n
Table: Links
Local IP        Remote IP       Hyst.   LQ      NLQ     Cost
10.10.211.1     10.10.132.1     0.00    0.000   0.446   INFINITE
10.10.211.1     10.10.153.1     0.00    0.000   0.713   INFINITE
10.10.211.1     10.10.134.1     0.00    0.000   0.909   INFINITE
10.10.211.1     10.10.136.1     0.00    0.000   0.808   INFINITE
10.10.211.1     10.10.143.1     0.00    0.000   0.646   INFINITE
10.10.211.1     10.10.234.1     0.00    1.000   1.000   1.000
10.10.211.1     10.10.157.1     0.00    0.121   0.815   10.084
10.10.211.1     10.10.140.1     0.00    0.000   0.713   INFINITE
10.10.211.1     10.10.147.1     0.00    0.000   0.748   INFINITE
10.10.211.1     10.10.210.1     0.00    0.000   0.329   INFINITE
10.10.211.1     10.10.138.1     0.00    0.000   0.847   INFINITE
10.10.211.1     10.10.145.1     0.00    0.000   0.000   INFINITE

-> lots of 'ath: phy0: Failed to stop TX DMA'



# alle flash-schreiboperationen sperrbar machen: global var: $STORAGE = /www/storage or /tmp/storage

# scp: immer absichern gegen haenger -> cron.webcam

# proof of work: zielmarke 1h update, 2h...4h...12h...dann erst "wifi on"
# bei unerwartetem reboot: erneut
# CONFIG_PROGILE: *_ap + reboots > X -> disabled wifi 

# make target_install -> rebuild images from the customized filesystem
# http://downloads.openwrt.org/docs/buildroot-documentation.html#custom_targetfs

# mon-server: automatically write OFF/Restart-history fuer every router?

# cupandcoffee

# BATMAN in hole net: disabled olsr + touch /tmp/service_olsrd_nowatching

# UPGRADE:
# busybox: package/utils/busybox/Makefile -> 1.21.1 -> 795394f83903b5eec6567d51eebb417e

# _switch() own history-file

# [ -n "$BATMAN" ] && ..     # uci get batman-adv.bat0 -> mesh

# ap: limit to 8 devices?

# /www/NETFILTER_AUTOADD: function for writing to disc without stopping firewall
# /www/NETFILTER_AUTOADD: if in DB/mac: direct _netfilter user_add

# sometimes we loose config.tgz - why? also store it on nexthop/linklocal-ping6?

# dmesg: 'net_ratelimit: 115 callbacks suppressed'

# Friwo Tischnetzteil ErP 12V 1A

# switch: wenn auf halfduplex abfaellt: reboot

# build tables: always restart if 0

# git clone git://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git linux-git

# find -name '*.sysupgrade.bin' | grep -v "\.r" | while read L; do md5sum "$L"; done

# detect silent hangs (on gateway?)
# track routes: ip r | wc -l
# no forwarded traffic for X minutes: reboot

# bssid_wellformed_fix fuer alle adhoc-netze

# early_boot: sometimes 'kalua_init' does not run -> override_uci does not work?

# reverse.ssh.tunnel: retry 25 times

# wifi/wartungsmodus -> inet_seems_stable

# force olsr-hna-slave: uci set olsrd.@olsrd[0].disabled=1

# button tickets: verfeinern, nur bei "autocreate" und vorrat zeigen

# mips/memtest:
# http://git.kernel.org/cgit/linux/kernel/git/torvalds/linux.git/commit/?id=272b9cad6e7a2f61b13cfcd7dde0010e02e9376e
# http://stackoverflow.com/questions/11640062/how-to-do-memory-test-on-arm-architecture-hardware-something-like-memtest86
# http://unix.stackexchange.com/questions/38887/how-can-i-test-the-ram-for-data-corruption-on-an-arm-based-system

# rrd: ping-time auf node im Netz

# check klog?: CPU 0 Unable to handle kernel paging request at virtual address --> Oops

# build: upload() if images small than 3.6mb, upload ONLY some additionally (e.g. WR-841ND)

# general class: _lock (auto unlock-trap?)


# B01 und allgemein: check incoming WIRED_OLSR: erste stunde = durchschnitt. jede minute pruefen.

# dont spam too much: loady_after_overload

# apply_profile: nanostationM: uci set wireless.@wifi-iface[0].antenna=mode - vertical|horizontal|external

# overrid_uci: makro fuer 'disable 2ghz adhoc' (double-hybrid-router)

# add a printk to the reghack.patch

# webcam: dont add files to movie when hash already was used before

# before reboot: scan -> file on flash with "mac: lastseen/signal"

# 1043er-Tickets:
# https://dev.openwrt.org/ticket/9654
# https://dev.openwrt.org/ticket/11862

# boltenhagendh: allow olsr-slave with huge OK-window (for not restarting olsr a lot of times)

# DB: index_gen for a single login should not force a full backup _now_ but later

#### incoming_wifi_activity spams log. only once for each changed framecounter

# workaround: long boot because long list in /www/NETFILTER_AUTOADD

# keine defaultroute in ap-mode? go hybrid (nicht permanent)

# rrd: better colors

# case "$( pidof scp )" in *" "*" "*" "*) echo ja;; esac

# rethink uci/log-settings e.g. for leds/syslog

# underload, anderen CRON killen:
# pidof sh
# cat /proc/$PID/cmdline: '/bin/sh-c. /tmp/CRON_IS_CAREFUL'

# ist jemand per telnet eingeloggt?
# pidof ash
# cat /proc/$PID/cmdline = "/bin/ash--login"


# during log(): local load="$( _system load 1min )"; test $load -gt 80 && { MESSAGE="LOAD:$load $MESSAGE"; PRIO=alert; }

# think about:
# it happens during:
# tc filter add dev eth0.1 protocol ip parent 1:0 prio 6 u32 match ip src 10.63.2.34/32 flowid 1:6
# tc filter del dev eth0.1 protocol ip parent 1:0 prio 10
root@EG-labor-AP:/ _netfilter_traffic_control_stop
RTNETLINK answers: Invalid argument
We have an error talking to the kernel
RTNETLINK answers: Invalid argument
We have an error talking to the kernel
RTNETLINK answers: No such file or directory
RTNETLINK answers: No such file or directory
RTNETLINK answers: Invalid argument
We have an error talking to the kernel
RTNETLINK answers: Invalid argument
We have an error talking to the kernel
RTNETLINK answers: No such file or directory
RTNETLINK answers: No such file or directory
RTNETLINK answers: No such file or directory

# IPv6 ausschalten:
* Global build settings -> [ ] Enable IPv6 support in packages
* Kernel modules -> Netfilter Extensions -> [ ] kmod-ip6tables 
* Kernel modules -> Network Support -> [ ] kmod-ipv6
* Network -> [ ] odhcp6c
* Network -> [ ] 6relayd
* Network -> Firewall -> [ ] ip6tables ???
* Libraries -> Firewall -> [ ] libip6tc

# HASH=59d13e5; for F in *; do case "$F" in *git.*) case "$F" in *$HASH*) ;; *) rm "$F"; esac; esac; done
# + link to it!

# simple tftp-server:
# 1043nd = 192.168.0.2
# ip address add 192.168.0.5/24 dev $LANDEV
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp	# with file 'code.bin'
# # erase 0xbf020000 +7c0000
# # tftpboot 0x81000000 code.bin
# # cp.b 0x81000000 0xbf020000 0x7c0000
# # bootm 0xbf020000
# # erase 0xbf020000 +7c0000; tftpboot 0x81000000 code.bin; cp.b 0x81000000 0xbf020000 0x7c0000; bootm 0xbf020000
#
# 4300:
# ip address add 192.168.1.100/24 dev $LANDEV
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp	# with file '6F01A8C0.img'
# on router:
# tftpboot 0x81000000; erase 0x9f020000 +7c0000; cp.b 0x81000000 0x9f020000 0x7c0000; reset
#
# 841nd v8:
# ip address add 192.168.1.100/24 dev $LANDEV
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp	# with file '6F01A8C0.img'
# tftpboot 0x80000000					# use WAN-port
# erase 0x9f020000 +0x3c0000
# cp.b 0x80000000 0x9f020000 0x3c0000
# bootm 0x9f020000
#
# 703n:
# ip address add 192.168.1.100/24 dev $LANDEV
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp	# with file '/tmp/6F01A8C0.img'
# tftpboot 0x81000000
# erase 0x9f020000 +0x3c0000
# cp.b 0x81000000 0x9f020000 0x3c0000
# bootm 9f020000
#
# 4900er:
# ip address add 192.168.0.104/24 dev $LANDEV		# with file 'uImage', router has '192.168.0.86' with mac '00:04:9f:ef:01:01'
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp
#
# tftpboot
# sf probe 0
# sf erase 0x60000 0xf80000
# sf write 0x1000000 0x60000 0xf80000
# reset
#
#
#
# Internetbox:
# 
#
# ip address add 192.168.0.100/24 dev $LANDEV
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp
# wget -O /tmp/1.srec http://downloads.openwrt.org/backfire/10.03.1/au1000/openwrt-au1000-au1500-vmlinux-flash.srec
# wget -O /tmp/2.srec http://downloads.openwrt.org/backfire/10.03.1/au1000/openwrt-au1000-au1500-jffs2-128k.srec
# sudo ip neigh change 192.168.0.1 dev eth0 lladdr 00:0e:56:00:0e:10 nud permanent
# sudo ethtool -s eth0 speed 10 duplex half autoneg on
# sudo ./ethernet_flash -i eth0
#
# set
# setenv bootserver 192.168.0.100
# setenv ipaddr 192.168.0.1
# setenv gateway 192.168.0.100
# ping 192.168.0.100	# for ARP
# erase -s		# ~120 seconds
# load /1.srec		# openwrt-au1000-au1500-vmlinux-flash.srec
# load /2.srec		# openwrt-au1000-au1500-squashfs.srec ~ 13mb size
# go
#
# mtd    write /tmp/vmlinux.bin kernel
# mtd -r write /tmp/fs.bin      kernel
#
#
#
# rb532:
# boot-proto = dhcp
# dnsmasq --port 0 --enable-tftp --tftp-root=/tmp	# mit vmlinux, e.g. openwrt-rb532-jffs2-128k.kernel 

URGENT:
- noolsr/ibfleesensee

- 1043ND: md5sum /dev/mtd0 :: strings /dev/mtd0 | grep U-Boot
  - ??? : dab5229a0cbe46160e8b8d0ef093eb2c :: U-Boot 1.1.4 (Nov 17 2009 - 11:56:26)	-> spbansin/haus6
  - ??? : d2acf2a1587e2349d858da14bd9fe445 :: U-Boot 1.1.4 (Nov 17 2009 - 11:56:26)	-> spbansin/haus12
  - good: 31ef3d5fad161ce7affbac0d0ae3293e :: U-Boot 1.1.4 (Nov 17 2009 - 11:56:26)
  - good: 17d63e8edb736df029cf6bc0391a080a :: U-Boot 1.1.4 (Aug  4 2010 - 20:06:51)	-> liszt28-2
  - bad:  12cb02c599ad92ed607d05e65daabd4e :: U-Boot 1.1.4 (Aug  4 2010 - 20:06:51)
    - wget -O /tmp/uboot.bin http://intercity-vpn.de/files/openwrt/bootloader_TL-WR1043ND_17d63e8edb736df029cf6bc0391a080a_WANok_U-Boot_1.1.4_Aug_4_2010.bin
    - mtd write /tmp/uboot.bin u-boot

- hybrid: no_incoming() fails? -> check AP
- always let 2 nodes ping monitoring server
- no shaping under X megabytes
- ticket-speed = real-speed
- multiradio: bssid adhoc varieren: = c11 c36
- multiradio: working dhcp
- index_gen nur bei ticket_gen?
- fix netfilter/splash for batman
- backup's db in die cloud, nicht auf flash
- conntrack auch in sysctl auf alten wert / eigene zeile raus
- check shaping when different interfaces are involved
- rehungen: apply_shaping after X mb
- spbansin: 812 + 908?
- spbansin: replace wrong bootloader
- batman: correct add if 'wlan0' to bridge via ifstatus <ifname>|grep ifname
- wenn load immer weiter sinkt (Tendenz), soll OVERLOAD nicht ausloesen
- cron.minutely: monitore olsr-packets on wire per minute (B01)
- wenn mehrere male 'ath: phy0: Failed to stop TX DMA' dann echo 4 >diag

TODO-next:
# - rrd: show users + overall users
# - rrd: show overall traffic in [mb]
# - master: outgoing with sourceaddress not from me? drop
# - leonardo: wan2 + alias wan + wan-dhcp + wan=free + extended reachable check for wan
# - speed auf pfad anpassen: regelmaessig fuer jeden node den max up/down ermitteln und in max-speed einfliessen lassen bei apply_shaping
# - reverse-ssh-tunnel: autossh?
# - reverse-ssh-tunnel: retry 10 times if conn will not establish
# - rrd: show stations: for S in /sys/kernel/debug/ieee80211/phy0/netdev:wlan0/stations/*; do echo $S; done
# - make use of netfiler 'notrack' for e.g. port53 dns
# - scp to monitoring-server: sometimes we need to regen keys, although everything seems good. the real check is to scp something to server. automate this.
# - patch inittab on LOWMEM for non-user-shell/askfirst
# - reboot not at timeX? message! (during ntp) 
# - ifup wan (when dhcp) before reboot? (to sticky the lease)
# - mail: set replyTO:
# - mail/smtp: implement 3 different smtp-gateways/methods
# - webcam-support UVC 1.00:
#   - HP Webcam HD-4110 (03f0:9207) = Seepark Bansin
#   - Microsoft® LifeCam Studio(TM) (045e:0772) = Buero Fenster
#   - SunplusIT PC Camera (1bcf:0b01) = 2te Lieferung HP?
# - support for specials: e.g. bigbrother (webcam-support), mini (4mb flash)
#   - build/upload: Buffalo WZR-HP-AG300H.bigbrother.r37106-kernel3.8.13-git.fb34ce2.sysupgrade.bin
#   - links() + apply_profile()
# - batman-modus im monitoring senden
# - update-server/monitoring-server: info.txt muss ein script sein, was hashes + files dynmaisch zusammensetzt
# - vtund-check in cron.minutely oder watch(): grep "tap0:" /proc/net/dev || action
# - sysupgrade fuer einzelnen knoten im wartungsfenster aktivieren: touch upgrade_next_window?
# - DHSYLT/K80/Netzwerksteckdose: bei sysupgrade weiter pingbar sein, auch:
    - iptables -I INPUT -p icmp                  -j LOG --log-prefix "ICMP: "
    - iptables -I INPUT -p icmp ! -s 84.38.67.43 -j LOG --log-prefix "ICMP: "
# - list() we always input a space separated list and out put a "\n" one - problems?
# - ath9k-error: cat /sys/kernel/debug/ieee80211/phy0/ath9k + echo 4 >/sys/kernel/debug/ieee80211/phy0/ath9k/diag ==> resetHW
# - firmware-upgrade: cannot unload kmodule IPv6: maybe delete allinet6 fe80::* stuff?
# - dns: change leasetime according to scheduled reboottime
# - switch: check if we can read the expected number of ports. otherwise: portmap: 'B.--C' was: 'B.---C'
# - use flock? http://stackoverflow.com/questions/13551840/bash-flock-why-200
# - NOTICE: /proc/<pid>/oom_adj is deprecated and will be removed, please see Documentation/feature-removal-schedule.txt.
# - myinfo.sh: show token + store_on_flash.$token
# - build: use folder "files" instead of occupy package/base-files
# - /proc/net/dev -> /sys/class/net/
# - boltenhagendh: hybrid = kanal 1 + komische bssid
# - ist olsr-hash wirklich noetig? hotello-B01: hash2: c44b44ba7a3612e2f6be3531ddcba407
# - support/use of 'logread -f -r server:port'
# - netfilter: enforce writing of NETFILTER_AUTOADD
# - nach reboot sehr schnelles monitoring-senden fuer IP _wenn_ local_inet_offer
# - batman for boltenhagendh
# - monitoring: fetch meshrdf if ping_error and ping_good again
# - log each reboot, (crash or manually) and calc real bootdate
# - batman: zweiter IP-Bereich oder groesser
# - faxe: antwort-fax-nummer mit drauf
# - batman: # zeile 512: echo "dhcp-range=bridge,192.168.5.100,192.168.5.120,255.255.255.0,10m" >> $CONFIGFILE
# - monitoring: make switch sortable (e.g. "all with inet-offer", all which are the same), just add +1 for each used port and +2 for inetofferport?)
# - ffweimar: WAN = dhcp + static + OLSR
# - neigh: show wifi/channel humanreadable?
# - ubus call hostapd.wlan1 del_client '{ "addr" : "00:21:6a:32:7c:1c", "reason" : "assoc toomany" }'
# - ubus call hostapd.wlan0 del_client '{ "addr" : "00:21:6a:32:7c:1c", "reason" : "assoc toomany", "ban_time" : 10000 }'
#   - http://resin.csoft.net/cgi-bin/man.cgi?section=5&topic=hostapd.conf
# - each node: accept forwarded, but filter outgoing packets, which have source-address ! ownHna4 (should do each ISP)
# - olsrd: fixup an ipv6 startup/both instances/concept
# - make all neighs arp-permanent
# - nutzen fuer kmdlinetweak: target/linux/ar71xx/Makefile LINUX_VERSION:=3.8.12
# - nach anmeldung umleitung auf "willkommen" + angebot: http://www.dorfhotel.com/angebote/hotelangebote-sport-golf-segeln-fahrrad-nordicwalking-yoga.html
# - apply_profile: no wlan-ifname in network
# - olsrd-init: restart() b0rken?
# - olsrd-init: ipv4 + ipv6
# - 1043er detect "wrong" bootloader/wan-problem
# - rrd: show overall values
# - update: spbansin/cam + dhsylt/central + vivaldi/central
# - monitoring: give up, when empty default route AND error
# - monitoring: generic support for "heartbeat"/hb
# - build-support: "bigbrother": multimedia: +fswebcam +ffmpeg +motion  utilities: +v4l-utils  kernelmodules: videosupport: +kmod-video-core +kmod-video-uvc
# - build-support: +rrdtool +kmod-batman-adv +kmod-ipip +kmod-sit +kmod-usb-printer +p910 +luci +mii-tool(9k)
# - crashlog.o: abstraktion: uhrzeit retten? rrd retten? tgz retten!
# - lowmem-device: shut down olsrd-txtinfo-plugin
# - lowmem-device: find more minimal iptables set?
# - Make: all hostapd-switches configurable
# - remove all calls to iwconfig/iwpriv/wext -> without iwconfig, it runs
# - /www/NETFILTER_AUTOADD: check before reboot and enforce readding
# - wan-detect via ifplugd or script
# - crondebug: kerneltasks: fgrep "0 SW" /tmp/CRON_PSWORK2 | wc -l
# - build: hostapd:
#   - remove: CONFIG_DRIVER_MADWIFI=y + CONFIG_DRIVER_WIRED=y + CONFIG_DRIVER_HOSTAP=y + CONFIG_RSN_PREAUTH=y + CONFIG_PEERKEY=y + CONFIG_IEEE80211N=y
#   - add: CONFIG_NO_VLAN=y
# - build: lowmem: remove CONFIG_UBUS=y from package/network/services/hostapd/files/hostapd-mini.config
# - cron.minutley: mesh/lowmem: ping -s 1337 = startup uhttpd
#   - iptables -I INPUT -p icmp -m length --length 1365
#   - ping -c 1 -s 1337 10.63.15.33
#   - or: https://github.com/libre-mesh/magic-icmp
# - check /proc/sys/vm/min_free_kbytes - http://lists.centos.org/pipermail/centos/2006-December/030766.html
# - nightly reboot: wait till forwarding is 0 for 60sec
# - crondebug: last longer than 60sec? -> CRONSTATUS + locked ans ende
# - klog: nf_conntrack: automatic helper assignment is deprecated and it will be removed soon. Use the iptables CT target to attach helpers instead.
# - log_debug() handle brdip = ff:ff:ff:ff:ff:ff
# - build: minimal: no px5g if nohttps, no debug: no package/network/ipv6/6relayd + odhcp6c + ipv6-support 
# - nightly_reboot() only unload/store vds - not fully stop packetfilter
# - wifiscan jede nacht - alle macs/ssid merken -> graph? -> kanalaufteilung? -> olsr-plugin?
# - netfilter_stop() without removing nat and without killing connection
# - netfilter_ror() in extra function
# - rrd: also store load over time
# - rrd: not inet_offer? plot rule 3 + 4
# - store dmesg for later checks?: cp /tmp/dmesg.log "/www/dmesg.log.$( _system date humanreadable )"
# - db_restore() soll auch serverkopie benutzen (und aus cron.evaluate_syslogd rausnehmen)
# - make incoming_framecounter base on 'iw dev $wifidev station dump'
# - repair nodes with broken webserverconfig
# - webcam: [ $( logread | grep "uvcvideo: Failed to set UVC probe control" | wc -l ) -gt 5 ] && reboot
# - webcam: make resolution uci-configurable + fix 450 pixels -> modulo 16 -> 448 px
# - solution for special macs / no shaping: liszt28: nasf36: 02:50:43:ab:1c:91
# - px5g nur nachinstallieren, wenn erst/einmalig benoetigt
# - fix watch_random_node_id() during apply_profile
# - generalize live-traffic shower per mac on commandline
# - rrd for inet-gw/wan
# - inactive for >x mins? -> throttling/shape to original values
# - override_uci: 10m leasetime wlan when ipsystem = normal
# - why does stats/yesterday not work?
# - check autostart of webserver, otherwise we always spam the log after each reboot
# - switch() give points per connection-speed so we can better log
# - netfilter: special mode for NETFILTER_AUTOADD + testing
# - log all reboots not @4.00 during successful ntp_set
#   - crashlog or unknown reason?
# - ntp_set via neighbour
# - uci -g get ueberall
# - monitoring: cat $WIFI_RESTARTS.wlan0 2>/dev/null
# - olsr-init: IFS immer retten
# - finetune max_length in monitoring
# - why S01/overrid_uci_vars is not called
# - is S00/generate_kalua_loader really working?
# - integrate new rules for ejbw / lan-dhcp
# - testing if new function client_list() build correct: fix /30 WAN
# - activate patch for rcS-watcher
# - no inet_offer and ! ping_to_nexthop (but not myself) -> reboot
# - cron-replace: while true; do sleep 60; command . /tmp/CRON_IS_CAREFUL; touch /tmp/CRON_IS_CAREFUL; done &
#   - http://intercity-vpn.de/files/openwrt/dmesg_r35300_error_mac80211_ath9k.no_cron_action_anymore.txt
#   - http://intercity-vpn.de/files/openwrt/dmesg_r35300_error_mac80211_ath9k.no_cron_action_anymore-ps.txt
#   - or use dhcpscript to check if cron is running (is correct uptime in file x)?
# - autolearn olsr-neighhash? (K80!)
# - debug 0 byte mailfile r99/l28
# - image smaller, so that image-on-flash works
# - compile/test atheros image with -O0
# - generischer modulloader fuer lowmem-geraete
#   - xt_TCPMSS|xt_REDIRECT|xt_NETMAP|aead|crypto_blkcipher
# - apply zramscript: logger --> _log calls + loglevel same as firmware
# - dont influence oom-score for watchdog (S70prepare)
# - convert _switch() for all known hw-types
# - everybody gets "hybrid", if there is no neigh with ap-mode
#   - if b43 and ap -> mesh
# - build/apply_profile: set IP for hybrid-network
# - mail: http://vger.kernel.org/vger-lists.html#netdev : complain about: ip route list exact 0.0.0.0/0 || action
# - loader: check if multiple args in loader can be $@ instead of $1 $2 $3 ...
# - loader: if a zero-byte class is found, use logger in loader and dont fail (e.g. db() for weimarnetz)
# - if ntp_set was successful, update: head -n1 /www/NETFILTER_AUTOADD (or use a dedicated mechanism)
# - build: auto-activate SWAP in kernel for atheros
# - helper-script: vds: last traffic of $IP or $NODE or $HASH (tar -tvkf "$file.lzma" --force-local)


# idea:
# /www/startsysupgrade: ap-mode? reboot:
# special module loader + leave wifi off + netfilter off + olsr-slave

# idea:
# during scheduler -U, replace crontab with '/usr/bin/scheduler -U'

# 16mb-routers:
# S72 / no monitoring

# 16mb-routers:
# olsr-hna-slave? no NAT modules needed?

# repair all calls to set without "--"
# git grep "set "|grep -v -- "--"|grep -v reset|grep -v "uci set"|grep -v "nvram set"

# R30:
# - laptop eintragen?
# - olsr-error during check_inet?


# build:
# all patches/applymyprofile via git

# weimarnetz-server:
# for M in floppy usbcore usb_common ehci_hcd uhci_hcd cdrom hid usbhid i2c_core i2c_piix4 joydev soundcore snd psmouse snd_timer snd_page_alloc snd_pcm; do echo "blacklist $M" >>/etc/modprobe.d/my-blacklist.conf; done
#


# umount /space; mount -t tmpfs -o size=6G,mode=0777 tmpfs /space
#
# build in /dev/shm, symlink these
# ./bin (2mb) ./build_dir (3.5gb) ./staging_dir (250mb) ./tmp (15mb)
#
# symlink this globally: (~250 mb content)
# mkdir -p /tmp/openwrt-downloads
# chmod -R 777 /tmp/openwrt-downloads
# ln -s /tmp/openwrt-downloads dl 


# http://www.useragentstring.com/pages/Browserlist/
# http://www.useragentstring.com/?uas=Opera/9.70%20(Linux%20i686%20;%20U;%20en-us)%20Presto/2.2.0


# patch: all ifconfig/route/arp/netstat calls can be wether with this or with 'ip' and build without these but with full 'ip'
# measure size change

# patch_kmodules: mode = remove_file()

# vivaldi:
for I in $( seq 34 46 ); do {
iptables -t nat -I PREROUTING -i $WANDEV -p tcp --dport 100${I} -j DNAT --to-destination 192.168.1.${I}:80
} done

iptables -t mangle -I PREROUTING -d 192.168.1.0/24 -j ACCEPT
iptables -t nat -I POSTROUTING ! -s 192.168.1.0/24 -d 192.168.1.0/24 -j SNAT --to-source 192.168.1.33
#iptables -t nat -I POSTROUTING ! -s 192.168.1.0/24 -d 192.168.1.0/24 -j MASQUERADE


# rehungen/userdb:
iptables -t nat -I PREROUTING -p tcp --dport 10080 -j DNAT --to-destination 10.10.8.33:80
iptables -t nat -I PREROUTING -p tcp --dport 10443 -j DNAT --to-destination 10.10.8.33:443
iptables -t nat -I POSTROUTING ! -s 10.0.0.0/8 -d 10.10.8.33 -j MASQUERADE
#
iptables -t nat -D PREROUTING 1
iptables -t nat -D PREROUTING 1
iptables -t nat -D POSTROUTING 1


# olsrd:
# dont start anymore if a stable olsr-master for myself (slave) is already found an safed, just refresh rules

# useful /etc/.vimrc:
set cul
hi CursorLine cterm=none ctermbg=darkgray ctermfg=white
syntax on
set syn=sh


# patch openwrt:
# git clone git://nbd.name/openwrt.git
# <make some changes>
# git commit		(respect http://tbaggery.com/2008/04/19/a-note-about-git-commit-messages.html)
#	subject e.g. '[packages] olsrd: use system-logger instead of dumping to stdout'
#	subject e.g. '[base-files] failsafe-mode: print short help on commandline'
#
# Betreffzeile 2 mal schreiben, dann ist es gleich in der Mail richtig
#
#
# git format-patch -s -1  ('s' means: add signed-off ...)
# git format-patch -s -5
# git format-patch -s $hash_of_last_commit_not_from_me
#
# scp -P 22 000* root@intercity-vpn.de:/var/www/files/openwrt/patches
# wget http://intercity-vpn.de/files/openwrt/patches/000...
# mutt -H "$file"	(http://blog.ndrix.com/2007/05/mutt-and-git-format-patch.html)
#
# testen:
# git send-email --to basti@bla HEAD~3

# patch b43:
# git clone git://git.kernel.org/pub/scm/linux/kernel/git/linville/wireless-testing.git
# <make some changes>
# git add .
# git commit -m "bla"
# git show >/tmp/my.patch
# sed -n '/^---/,$p' /tmp/my.patch >/tmp/841-b43-raise_dma_rx_ringbuffer_to_128.patch


# ideensammlung 'init' -> procd
# - source a shellscript every 60 sec
# - refresh watchdog every x sec
# - syslogd
# - klogd
# - hotplug2
#
# http://www.landley.net/hg/toybox/file/aad12ce05aae/toys/other/oneit.c
# http://spblinux.de/2.0/doc/init.html
# http://busybox.net/~vda/init_vs_runsv.html
# http://www.centos.org/docs/5/html/5.1/Installation_Guide/s2-boot-init-shutdown-init.html
# http://smarden.org/runit/


# monitoring: better show +123 more dmesg lines after boot

# liste aller freigeschalteten macs direkt in dhcp-script aufnehmen
# beim ersten cron.check_inet vom server holen:
# grep "C='..:..:..:..:..:..'" /tmp/DB/USER/login/rows | cut -d';' -f4 | cut -d"'" -f2


# userdb-gui:
# vorrat/ticketsart und in db_ticketcheck beruecksichtigen
# boltenhagendh: mehr 3-tagestickets


# userdb-gui:
# berichte: tages/wochen/monats + email angeben

# userdb-gui:
# berichte: taeglich: top 10 user?

# olsr_hna_slave:
# verbieten wenn master nicht _ipsystem wie ich hat (ejbw, wanolsr)

# why this?
# /etc/init.d/S69watch_olsrd_fff+ [daemon.alert] watch_dhcp_space() clients: lan: 0/150 wifi: 1/0

# make sure to use the password hash in /tmp/vds_user_$mac, even when we
# are freed by "already known on other station"


# bugreport:
# - show normal olsr-neighs-table without error


# rehungen:
# - ask user-data every 3 month,
# - reset passwords 


# myinfo.sh:
# - start test via button and show download-speed in numbers


# rehungen: dns:
# - erzwingen von DNS = 10.10.8.33 ausser auf: sollstedt etc.
# - erlaubenvon wan-dns in Kindergarten
# - remove alias 10.1.0.8 auf kindergarten

# firmware-simpler schneller/sicherer:
  - ZENTRALER NODE = ZN
  - kein update/warten, wenn gerade AP-clients connected
  - ZN gibt firmware-datei raus? nein, muss proxy-cache erledigen
  - vor update: abmelden an ZN nach apply_profile + reboot = anmelden an ZN
  - erst dann freigabe fuer naechsten
  - alles ist gelockt mit angabe in sekunden, wann ca. erneute anfragen gestellt werden darf

# wartungmodus:
  - erstmal manuell per shell-wizard + script auf router
  - alle clients rauswerden
  - startseite = wartungsmodus
  - dnsmasq beantwortet alles mit $WIFIADR


# force minimal olsrd-setup for 16mb routers (only plugin txtinfo)

# apply_profile: use '/cgi-bin/:root:$p$root' if possible for uhttpd

# log/sms: sms.@sms[0].username / sms.@sms[0].password

# patch sysupgrade for also using /dev/console

# when in dmesg: 'failed to initialize PHY', no unloading of wireless stuff before sysupgrade

# kill ubusd, procd before sysupgrade?

# hack: activate shaping only for users which have over >mb

# if we know how long a task will last, feed a "box" with minute-signs, and cron-overload-detector will eat them up over time

# traffic ueber tunnel: config-option, wenn auch ueber lan

# split scheduler jobs into sourceable files, e.g. "w" and "O"

# rootserver: tun/tap per hna4 ankuendigen - pauschal fuer jeden

# remove dead-netfilter users midnight

# always remove dhcpscript for lowmem-devices, except if explicit configured

# deny tool if action?: while :;do ps | fgrep CRON_IS_CAREFUL | fgrep -v grep ; sleep 1; done

# wget: maybe do normal wget, but mark for cron_watcher?

# userdb-copy via wget()

# pdf-versand: seitennummern

# sms bei ticketversand nur 1mal, nicht pro seite


# beim 15min-summary abliefern neue tickets als used markieren/abziehen

# beim 15min-summary abliefern erlaubte mac's/Logins mitliefern


# wenn olsr-nachbarn nud=permanent sind, arp-plugin ausschalten
# sonst haut das plugin immer wieder rein in _net arp_permanent()

# packages automatisch mit passendem datum auschecken wie openwrt-git

# _olsr_uptime() work with uptime instead of date - check other function too

# system_date() to class date()

# check kmodules-hack for working pppoe

# 
# ssh bastian@gcc20.fsffrance.org

# userdb-GUI: force global fuzzy

# [ERR] are wired neighbours LQ/NLQ nearly synchronous? no! REMOTE/LQ/NLQ = '10.10.31.33'/'1000'/'0'
# uci changes | fgrep 10.10.31.0	// ignore hna-slaves

# monitoring: remove 0 byte or small db-backup


# 1) harte route setzen
# 2) while :; do ssh $IP; sleep 10; done
# 3) echo 4194304 >/sys/block/zram0/disksize; mkswap /dev/zram0; swapon /dev/zram0
# 4) comment 'killall dropbear' in /etc/init.d/S70prepare_fff+
# 5) uncomment usb-stuff in /etc/kalua/netfilter
# 6) rm /www/GOOD_MODULE_UNLOAD
# 7) reboot && exit

echo 4194304 >/sys/block/zram0/disksize; mkswap /dev/zram0; swapon /dev/zram0; sed -i 's/dropbear/dropBear/' /etc/init.d/S70prepare_fff+
sed -i 's|/etc/kalua_init|/etc/kalua_init;echo 4194304 >/sys/block/zram0/disksize;mkswap /dev/zram0;swapon /dev/zram0|' /etc/init.d/generate_kalua_loader 
sed -i 's/sleep 30/break;sleep 30/' /etc/init.d/apply_profile; sed -i 's/crond/crondBLA/' /etc/init.d/apply_profile
rm /etc/modules.d/19-usb-brcm47xx /etc/modules.d/50-usb-ohci /etc/modules.d/20-usb-core
sed -i 's/_wifi vendor_and_model_usb/# _wifi vendor_and_model_usb/' /etc/kalua/wifi; rm /www/GOOD_MODULE_UNLOAD; reboot && exit


# monitoring: dmesg:
# SQUASHFS error: Unable to read page, block c52d2, size ebb8
# SQUASHFS error: Unable to read fragment cache entry [c52d2]

# watch_random_node_id() really enforce apply_profile, if nodenumber clashes/registrator complains 

# echo 4194304 >/sys/block/zram0/disksize; mkswap /dev/zram0; swapon /dev/zram0

# package: ffweimar-mapstraction-karte

# rehungen: dont allow weblogin <r33726 (after updating hybrid-router)


# find a way to auto-config:
# hybrid
# dualradio: ap/ap
# dualradio: hybrid/ap
# dualradio: ap/adhoc

# liszt28: etx_ffeth + 02:ca:ff:ee:00:11 + kanal 11

# apply_profile: always do bssid_wellformed() even in 11g mode and preset to "02:ca:ff:ee:ba:be"

# sms bei ticketversand konfigurierbar machen

# monitoring: change order if ssid's in hybrid mode (first "Hotello", then 'bb')

# fusionpbx
# ^03643?(\d{5-8})$
# the ^03643 means that the number can start with 03643 but its optional

# rehungen 10.1.0.8 auf richtfunk ändern zu 10.10.254.33
# auf 8/kindergarten: + hna4 10.1.0.8/32

# apply_profile: boltenhagendh: festscheune: free-login

# apply_profie: config: dhcp: list notinterface = wan ::: nur wenn auch einspeiser, netzintern egal (rehungen8)


# on both servers:

# MYDIR="y"; ARCH="brcm47xx"; R=34054; FILE="openwrt-brcm47xx-squashfs.trx"; HARDWARE="Buffalo WHR-HP-G54"; K=3.3.8
# MYDIR="z"; ARCH="ar71xx";   R=34054; FILE="openwrt-ar71xx-generic-wzr-hp-ag300h-squashfs-sysupgrade.bin"; HARDWARE="Buffalo WZR-HP-AG300H"; K=3.3.8
# MYDIR="x"; ARCH="ar71xx";   R=34054; FILE="openwrt-ar71xx-generic-tl-wr1043nd-v1-squashfs-sysupgrade.bin"; HARDWARE="HARDWARE.TP-LINK TL-WR1043ND"; K=3.3.8

# on build-server:
$DO r$R "$HARDWARE" standard kernel.addzram dataretention trafficshaping kcmdlinetweak

# on file-server:
# scp bastian@46.252.25.48:$MYDIR/release/openwrt/bin/$ARCH/$FILE "${HARDWARE}-exp-r${R}-${K}.sysupgrade.bin"
# cp "${HARDWARE}-exp-r${R}-${K}.sysupgrade.bin" "${HARDWARE}.sysupgrade.bin"; md5sum "${HARDWARE}.sysupgrade.bin"




# db_cleanup()
# = remove old entries from stats >1 month
# = dont hash login-entries older than X month untouched

# while :; do netstat -an 2>/dev/null | grep $LANADR:80 | grep ESTABLISHED | while read LINE; do set -- $LINE; echo -n "$( echo $5 | cut -d':' -f2 ) "; done | sort -n; test -z "$LINE" && echo "#"; sleep 5; done


# erste inbetriebnahme: _db_backup() schlaegt fehl. checken
# touch ... noetig


# forbid udp-source-ip-spoofing: sudo hping3 10.63.99.33 --udp --spoof 192.168.1.150


# package: ekuku-longshot: ath5k -b43 +mii-tool
# package: rrdtool


# rrd:
# each router
# each user
# each login


# high load + multiple dropbear-pids: shutdown dropbear
#
# needs iptables-mod-conntrack-extra: _net local_inet_offer && {
# iptables -I INPUT -i $WANDEV -p tcp -m tcp --dport 22 -m state --state NEW -m recent \
#  --set --name DEFAULT --rsource
# iptables -I INPUT -i $WANDEV -p tcp -m tcp --dport 22 -m state --state NEW -m recent \
#  --update --seconds 180 --hitcount 4 --name DEFAULT --rsource -j DROP
# http://www.digitalsanctuary.com/tech-blog/debian/using-iptables-to-prevent-ssh-brute-force-attacks.html
# }


# FILE_IN=youtube.flv
# FILE_OUT=vtech_kidizoom.avi	// 102_0366.avi
# ffmpeg -i "$FILE_IN" -r 25 -ab 16k -ar 22050 -vcodec mjpeg -b 64k -acodec pcm_s16le -ac 1 -s 320x240 -sameq "$FILE_OUT"


# complex feedback during server_ask weblogin() -> speed, traffic, yes/no, special message etc.


# for i in $(seq 0 255); do hex="$( printf "%X\n" $i )"; echo "$i: $hex: $( eval "echo \$'\x$hex'" )"; sleep 1; done


# bytes bei user_del speichern und bei user_add apply?


# wenn ramdisk voll, dann logrotate checken: manchmal ist /www/everlasting_syslog weg

# speedwerte in file schreiben
#
# change per user traffshaping implementieren: percent from original OR percentual change (down to 75% OR -5%)
#
# change per profile alle 15mins (?) neu applien (kurven vor ermitteln)


# best practise for making an hybrid-router (adhoc+ap):
# in /etc/config/network add (beside to normal wlan-network)
#
# config 'interface' 'wlanadhoc'
# 	option 'ifname' 'wlan0-1'
# 	option 'proto'  'static'
#	option 'ipaddr'  'same like in network wlan'
#	option 'netmask' 'same like in network wlan'
#
# in /etc/config/wireless add
#
# config wifi-iface
#	option device   radio0
#	option network  wlanadhoc
#	option mode     adhoc
#	option bssid    '02:ca:ff:ee:ba:be'
#	option ssid     'bb'
#
# config wifi-iface
#	option device   radio0
#	option network  wlan
#	option mode     ap
#	option ssid     'myAP'
#

# implement correct ipsystem() for vivaldi
# and integrate into definitions

# fix profile_counter -> faster check, run every night for every ticket
# dont lock weblogin-via-mac-enabled clients during db_process
# make use of SNI?: http://en.gentoo-wiki.com/wiki/Apache2/SSL_and_Name_Based_Virtual_Hosts 

# Make panic_on_oops configurable / always on
# http://lkml.indiana.edu/hypermail/linux/kernel/1204.1/01389.html

# weblogin:
# support for single-string-login

# _netfilter user_list verbose
# xx:xx:xx:xx:xx:xx $ip $dev $tx $rx $shape_in $shape_out

# option for not kicking users over time, but slow them down to 8kbit/8kbit -> move to another profile?
# if not used for X days, remove from DB

# why index_gen is fully done after creating 32 tickets? -> implement also index_gen for a specific entry

# implement wshaper.htb for each user

# make var: LOCAL_INET_OFFER=lan

# better force of reboot for lowmem-devices each night

# why does olsr_restarts_over_limit() not work in lowmem-AP?

# add: kernel.hung_task_panic=1
# add: softlockup_panic=1

# remove all: _uci is_oldstyle

# kalua_init: allow 0 byte classes and allow all calls to them

# netfilter: mode for redirect of DNS requests to me, must be done global or per user

# fake-hybrid: update:
# F=/etc/config/wireless;I=0;while read L;do case "$L" in *wifi-iface*) I=$(($I+1));;esac;test $I -gt 1 && L="#$L";echo $L;done <$F >/tmp/W;mv /tmp/W $F
# F=/etc/config/wireless;I=0;while read L;do case "\$L" in *wifi-iface*) I=\$((\$I+1));;esac;test \$I -gt 1 && L="#\$L";echo \$L;done <\$F >/tmp/W;mv /tmp/W \$F

# debug uhttpd:
# /usr/sbin/uhttpd -h /www -r HOSTNAME -c /etc/httpd.conf -x /cgi-bin
# -t 60 -T 30 -A 1 -E /cgi-bin-404.sh -I cgi-bin-404.sh 
# -n 1 -p 0.0.0.0:80 -i .sh=/bin/ash -C /etc/uhttpd.crt -K /etc/uhttpd.key -s 0.0.0.0:443


# use "cutycapt" for make screenshots/pdf of webpages
# and for automatic walled_garden-url's -> list_of_ipaddresses

# add to website: https://github.com/blog/273-github-ribbons

# everything before the first :
# ${varname%%:*}
# everything after the first :
# ${varname#*:}
#
# always use 'set -- $var'

rm /www/channel_try
for i in $(seq 1 300); do
	uci set wireless.radio0.channel=$i
	wifi
	sleep 8
	[ -z "$(iwconfig $WIFIDEV | grep "Not-Associated" )" ] && echo $i >>/www/channel_try
done >/dev/null

# netfilter user_add: make an option 'force' for ignoring reachability

# autoapply config_ath9kdebug if possible during standard-conf

# abstraction for ticketcounter "_counterA", use: watch_counter() + set in _db_autocreate_tickets_and_send_mail() and _db_ticketcheck()

# DSL-modem/get values: http://www.webtemp.org/?page=sm50b

# wan-dhcp? -> use dns provided by wan, not 8.8.8.8

# unselect b43legacy
# CONFIG_PACKAGE_kmod-b43legacy is not set

# why do WZR/dual-radio have problems with beeing an olsr-slave?

# check: how does it look, if ip must be reauthenticated during send_mail()?

# kirkwood:
# use flash_eraseall and nandwrite -p from mtd-utils
# I mean flash_eraseall both the kernel and rootfs partition
# nandwrite -p the kernel to the kernel mtd
# mount -t jffs2  the rootfs mtdblock
# and tar -C /mnt -xzf openwrt-kirkwood-rootfs.tar.gz
# all this is best done from within an initramfs image


# after r32739 it should be enough to use "sed -ne ':package; /^Package: / { s/.*: //; h; :line; n;
# s/^Status: .* \(.*\) .*/\1/; /^user$/ { x; p; }; t package; b line }' /usr/lib/opkg/status" to find the list of user
# installed packages

# css-sprites for weblogin?

# check 15mins: tmpfs full?

# ticketcheck: use idX_counterA for fast processing

# b43:
# http://permalink.gmane.org/gmane.linux.drivers.bcm54xx.devel/10680

# automate build / continous integration via
# echo "# CONFIG_foo is not set" >> .config; make defconfig

# lowmem-device: make sure ulogd is not started by default; /etc/init.d/ulogd disable
# option for enforce dns for specific client: iptables -t nat -I PREROUTING -p udp -s 10.63.99.6 --dport 53 -j DNAT --to 10.63.99.1
# special longshot-mode, ping always, log stats (timeouts) -> simply set IP to check
# _watch inetoffer() -> restart masq, if no -> yes

# captive portal with oauth support
# https://github.com/livibetter/bash-oauth/blob/master/OAuth.sh

# http://holstentor.metameute.de/nodes/nodes.html

# show (count?) interesting tasks:
#
# ps | while read LINE; do set $LINE
#	case "$5" in
#		COMMAND|init|watchdog|uniq|sort|sleep|ps)
#		;;
#		"["*)
#		;;
#		*)
#			basename $5
#		;;
#	esac
# done | sort | uniq

# A="$( grep " sda"$ /proc/partitions )"; set $A; echo $3/1024 ->kilobyte

# debug: paste in /etc/functions.sh
# iw(){ logger -s "iw $@"; /usr/sbin/iw $@; };
# ifconfig(){ logger -s "ifconfig $@"; /sbin/ifconfig $@; };

# hook in system_date() for setting time
# check if 'option hidden 1' makes sense for adhoc-mode-only routers

# auf DSLer/Satama: ip: 10.63.119.1
# iptables -t nat -I PREROUTING -i $WANDEV -p tcp --dport 443 -j DNAT --to-destination 10.63.222.1:80
# iptables -t nat -I POSTROUTING -d 10.63.222.1 -j MASQUERADE
# test: http://pubip:443/robots.txt

# auf DSLer/FparkSsee: ip: 10.63.222.1, interner zielrrouter: 192.168.101.112
# iptables -t nat -I PREROUTING -s 10.63.119.33 -p tcp --dport 80 -j DNAT --to-destination 192.168.101.112

# more generic solution for simulated hw-clock

# dell-2300:
# robocfg show (egal ob LAN- oder WAN-kabel steckt)
#
# probing eth1
# phyid: Success
# probing eth0
# phyid: Success
# bcm53xx_probe: Success



build()
* bug: minor: same gitrev-tarball must have the same hash
* bug: minor: leave channel untouched in AP-mode, when rewriting profile
* bug: minor: http://wiki.openwrt.org/doc/howto/vpn.nat.pptp
* feature+: (testing) no stopping cron.minutely due to SSH-action on all inet-offer-nodes
* feature+: use .txz instead of .tgz for tarball
* feature+: include mysshpubkeys.ipk -> /root/.ssh/authorized_keys | known_hosts
* feature+: include mydesign + mysettings
* feature+: build /tmp/loader + kalua_working_dir on demand directly in the image (safes space)
* feature+: rework zram-stuff, simple append '; echo >$size >$kernel' to /etc/modules.d/00-zram
* feature+: apply_profile: better use dhcp-space on wifi
* feature+: ipsystem() cleanup variables-usage, throw away everything which is not used
* feature+: ipsystem() new var: NETDEVPRE=WAN|LAN|WIFI - show if $IP is from lan/wan/wifi
* feature+: autoinstall/deinstall_if_needed of: luci-mod-admin-full + luci-theme-bootstrap + ( libiwinfo-lua )
* hardware: Picostation M2 = dmesg: "MyLoader: sysp=f0f0f0f0, boardp=f0f0f0f0, parts=f1f0f0f0" + "mtd: partition "rootfs_data" created automatically, ofs=3A0000, len=410000"
* hardware: Bullet:        = dmesg: "MyLoader: sysp=f0f0f0f0, boardp=f0f0f0f0, parts=f0f0f0f0" + "mtd: partition "rootfs_data" created automatically, ofs=390000, len=420000"
* specialtweak: elephant/76: dualradio/olsr-hna-slave-error?
* specialtweak: apply_profile: olympia/2: telefonanlage -> OlsrMainIp = $WIFIADR
* specialtweak: apply_profile: hotelloB01/K80: disable olsr-hna-slave
* specialtweak: preskil: timezone "MUT"
* specialtweak: fparkssee: 222: olsrd: hna-offer (it's over lan)
* specialtweak: marinapark: inet:96/10 :announce alias-ip
* specialtweak: galerie: 3_inet: no wan OLSR
* specialtweak: fparkssee: 223: must have 152 for neigh? -> rapid shrink of routing table?
* specialtweak: ejbw/52 -> landhcp on (flurtelefone)

vpn()
* feature+: cleanup andi's approach

netfilter()
* bug: major: use a dummy policy-routing rule on simplemesh to avoid clients
* bug: minor: remove /tmp/user-$HASH* during restart()
* documentation: describe dependencies for each mode
* feature+: move vds-data to user's dir /tmp/NETFILTER/USER/$MAC/dataretention
* feature+: support special dir for vds-data, e.g. softlinked to usbdisk?
* feature+: conntrack_max++ on 32mb+: http://wiki.imagestream.com/wiki/Resolving_%22ip_conntrack:_table_full,_dropping_packet%22_errors
* feature+: check if connection_tracking is really of when '-m state --state' is not used
* feature+: maintenance-mode() on: enforce 5353-dnsmasq + logout all + show special message in weblogin off: back to normal + simulate 8.8.8.8
* feature+: detect 0x1337-port action ("a neighbour reboots")
* feature+: config-option to forbid forwarding for local-net-clients ("no clients"), to have a simple/fast setup on mesh-nodes
* feature+: masquerade "$exception/$cidr"
* feature+: portforwarding start|stop: iptables -t nat -I PREROUTING -p tcp -i $WANDEV --dport 222 -j DNAT --to-destination 10.63.2.34:22
* feature+: user_quota add|del "$mac" "$upload" "$download"
* feature+: user_quota query "$mac" <up|down|all>
* feature+: user_quota diff "$mac" <up|down|all>
* feature+: user_speed add|del "$mac" "$upload" "$download"
* feature+: user_adblock add|del
* feature+: olsr_whitelist (no more double ip's by accident) + monitoring bad packets
* feature+: use "passiv" speedtesting with connbytes: packets/quantum


lowmem()
* feature+: maintain a list if essential kmods/hardware-type, instead of checking each if used
* feature+: dynamically remove wandev, if not needed
* feature+: switch off lan-dhcp on APs
* feature+: switch off dhcp-script in APs
* feature+: use zram-based ramdisk instead of tmpfs (frontswap/cleancache)
* feature+: measure ssh-port-activity, kill daemon if no action for x minutes
* feature+: build config_profile-specific dhcp-script during startup (lowering condition checks/size)
* idea: instead of crond, use: 'while :; do . /tmp/cron.script; sleep 60; done &' -> problem? does it really safe mem?

misc()
* bug: major: fparkssee/222: cron.check_inet_gw / laninet_offer
* bug: major: patch mtd.c for verify + correct error-codes, respect that in sysupgrade
* bug: major: netintern scp with pubkeys is b0rken?
* bug: minor: why hangs '/etc/init.d/rcS' + 'logger' in tasklist
* bug: minor: wget_do() always cleanup fragments in ramdisk /tmp/wget_do_*
* bug: minor: change timing for inet-speedtest to be more accurate
* bug: minor: speedtest without iptables -> use /proc/net/dev -> e.g. $WANDEV
* bug: minor: change server/file for inet-speedtest (roundrobin)
* bug: minor: during speedtest disable any forwarding to be more accurate
* bug: minor: remove all occurences of normal wget: cron.upgrade_packages / cron.evaluate_ulogd / speedtest?
* bug: minor: read dbclient cmdline + check ssh/http-reverse-ssh-tunnel correctly
* feature+: collect radio-stats each minute (ath9k)
* feature+: shell/logger: lookout for a way the handover "interactive" mode, e.g. *.sh calls another *.sh
* feature+: use curl or ssl-enabled wget for HTTPS-based REST for internal communication instead of plain HTTP
* feature+: set a maximum pause/uptime before running a scheduler job/in general, so we have "unknown" reboot
* feature+: firmware_burn() no pause in image-on-flash mode
* feature+: get rid of the cronwatchdog.sh
* feature+: use something like crondog.o, which pitches the kernel watchdog every 20 secs
* feature+: kalua-loader: only regen, if md5sum differs (overall/each class)
* feature+: if inet_offer via WANDEV, check regulary ping to gateway (primacom-problem)
* feature+: overclocking WRT54G? http://www.dd-wrt.com/wiki/index.php/Linksys_WRT54G/GL/GS/GX#Clock_Speed_and_Overclocking
* feature+: overclocking WHR-HP-54g (EU-version)? http://www.dd-wrt.com/phpBB2/viewtopic.php?p=102911&sid=01f76318a484a52a3267e4c2fe61ef41
* feature+: choose random channel on ap on early boot
* feature+: firmware_update_pmu() needs locking
* feature+: make logile-archive-length (monitoring etc.) configureable and limit it on lowmem-devices
* feature+: uci2nvram-wrapper for having a configureable lowflash-squashfs-only-device
* feature+: after setting time with ntp, safe /tmp/uptime2unixtime - so we have an offset for easy calculating
* cleanup: use generic locking-mechanism and use /tmp/lock
* cleanup: remove all calls to nvram-stuff
* cleanup: remove all calls to _uci is_oldstyle()

documentation()
* feature+: add screenshots of userdb-gui
* feature+: add screenshots of several splash-pages/captive-portals/weblogins
* feature+: add script for generate functions-call-graph with arguments

upgrade_packages()
* feature+: success? broadcast to all neighbours: "do it now"
* cleanup: use wget() for fetching or maybe activate busybox-option 'wget -T xxx'
* cleanup: use full opkg features for upgrade: if package-source-list is in ramdisk, temporarily hide full repo but leave ours alive and use 'opkg update', 'opkg install mydesign' (upgrade?)

switch()
* bug: minor: be correct when translating vlans, e.g. if somebody has changed the position of wan-port
* feature+: check every minute, if state of wan-port has changed: do ifup/ifdown accordingly
* feature+: detect permanent status-change of one or more ports
* feature+: detect time of port-status-change and include in monitoring

pdf()
* feature+: ongoing site-numbers for overview
* feature+: ongoing ticketnumber for labels

monitoring()
* bug: minor: after each correct transmitted line, move the OK-mark one line further (now, a wrong transmission after line 99/100 will cause an retransmission of all 99 lines)
* feature+: implement heartbeat, which simply refreshes old values ("no change, but alive")
* feature+: add some more speedtest-servers/files and use appropriate, e.g. in mauritus: http://www.gov.mu/portal/goc/educationsite/file/Livelihood%20And%20Trade%20Skills%20Book.pdf
* feature+: show: minstrelRX from my wifi-gateway '_tool remote $gateway minstrel'
* feature+: show: /www/dmesg.$$ + how many lines dmesg has raised during boot
* feature+: show: how many connection time, how many wifi-clients
* feature+: show: dhcp via trafficlight: LAN-max+used|WIFI-max+used|dhcpscript-on/off|dnsserver (color=symbol or ip)|cachesize|queries|cachehits|size:/etc/local.hosts (adblock)
* feature+: show: olsrd on/off
* feature+: show: last weblogin-fetch
* feature+: show: last weblogin-good-login
* feature+: show: last dhcp-offer
* feature+: show: db: profiles/logins/devices/index?
* feature+: different/shorter intervals for different values
* feature+: for specific changes fire a monitoring send immediately
* feature+: show: detect usb-stick plugin/out
* feature+: show: per neigh: HT20/HT40, LGI/SGI, MCS xy/rate
* feature+: show: wifi_signal() non_olsr_clients
* feature+: show: count of different connected clients LAN/WIFI + conn_time
* feature+: show: last wifi_phy_restart() reason (if any)
* feature+: show: count of usertunnels
* feature+: intranet internal aggregation of monitoring data
* feature+: network-map with javascript: http://thejit.org/demos/ -> http://thejit.org/static/v20/Jit/Examples/ForceDirected/example2.js
* feature+: network-map 3d with js: http://mrdoob.github.com/three.js/ -> http://mrdoob.github.com/three.js/examples/canvas_lines.html

monitoring-server()
* bug: password-protect admin-interface
* bug: accept/deny hostname if more than one is given (e.g. changed a correct hostname)
* feature+: allow change of arbitrary values via webif
* feature+: show olsrd-errors in relation to time-unit
* feature+: detect devices with always short uptime
* feature+: use 'logo.gif' from 'design.ipk' of all profiles to build a nice summary

olsr()
* bug: major: check_plausi() costs_getting_worse: doess the double check really work? (comparing correct database?)
* bug: minor: olsr-hna-slave: don't become a slave, if behind is an further olsr-neigh (e.g. at wandev, but default is via lan)
* bug: minor: olsr-hna-slave: master: block olsr-packets from slave before restarting daemon, otherwise we get the hna again
* feature+: deactivate arp-plugin, make arp permanent during check_plausi()
* feature+: olsr-hna-slave: if OK for specific host is often, output NEVER
* feature+: olsr-hna-slave: if answer is NEVER, dont try again this ip
* feature+: olsr-hna-slave: force to ask a specific neigh, if "ip" is set via uci
* feature+: maintain a list of all HNA-entries, lookout for missing ones
* feature+: check_plausi: detect: no_wifi_neigh, but had_good_before
* feature+: check_plausi: detect: lost a good neigh

sms()
* feature+: simplify procedure and use/send only one token (not username+password)
* feature+: premium-sms
* feature+: text2pay
* feature+: smsbox.net

fax()
* feature+: implement sipgate-API

userdb()
* bug: major: check if '_db user device show $ID' can be changed to be more exakt, e.g. append 'last'?
* bug: major: respect settings how much macs/devices are allowed to getin with one login (b0rken)
* bug: major: respect group-logins during device-check (e.g. devices eat up limit for 1 login)
* bug: minor: respect race, if index_gen runs, but new logins will be added
* bug: minor: change specific login -> index_gen runs not automatically or wrong
* feature+: implement ticket-print for Avery Zweckform Quick&Clean C32011
* feature+: remember last OK ticket-mail-sending - profile specific
* feature+: list_logins: last week, last month ...
* feature+: during cron.add-traff, built: active_users.html -> show in userdb-gui (+overall time/traff)
* feature+: index_gen() allow specific login (fast!)
* feature+: report() username/password or login_id -> fetches all devices
* feature+: report() $mac: -> PDF -> email
* feature+: report() show XX devices on YY routers
* feature+: report() top 10 users, top 10 devices
* feature+: report() show theoretical max download and "x percent of" for top-graphs + typical up/download ratio
* feature+: report() rotate_view() http://meinews.niuz.biz/re-t496245.html?s=1bf4dc343372425d68a62bcd18de7a6d&amp;
* feature+: report() punchcard: http://g.raphaeljs.com/dotchart.html
* feature+: report() traffic: http://g.raphaeljs.com/linechart.html
* feature+: measure tickets/s during index_gen and safe this value
* feature+: during index_gen write a mark each 30sec according to speed-value (see above)
* feature+: profile: allow access to internal network: yes/no
* feature+: profile: sanitize all speed-values to integer
* feature+: meta: weblogin = username/password | sms | both: (which is default)(user selectable)
* feature+: meta: weblogin is blocked, if hostname is virgin: yes/no
* feature+: meta: emails, sms-numbers, fax-numbers 
* feature+: meta: object name, speed uplink/downlink, ...
* feature+: meta: default language for weblogin (=order of languages)
* feature+: login: add message to user on next login
* feature+: login: temporarily disable a login
* feature+: relation between login and free-lan-dhcp-device
* feature+: list_logins: show used_or_not
* feature+: list_logins: show last used time
* feature+: username_namespace: 'islands of the world'
* feature+: auto distribute DB over network
* feature+: after making e.g. 32 logins, print a direct link to overview
* feature+: index_gen() if password = number && fuzzy-mode -> _list uniq $(hashes)
* cleanup: move hardcoded db-servers into config_var which is set during apply_profile

weblogin()
* bug: minor: translate logout-page
* bug: major: sms-mode: make sure, that phonenumer is safed in database
* cleanup: minor: change/translate varnames in terms_of_use.meta
* feature+: link to installation-object-name/webpage on logo
* feature+: fakepop / autoanswer pop3 action ("please login")
* feature+: make use of user-language via HTTP_ACCEPT_LANGUAGE
* feature+: make the sms-auth only visible in configurable timeslots
* feature+: implement credit-card API for payment
* feature+: implement import of xml/csv logins

usertunnel()
* bug: minor: allow local entry in/out: e.g. direct connection to inet_offering node
* bug: minor: check via ping the other tunnel-end - stop tunnel if fails (test: server reboots)
* bug: minor: disconnecting client: rewrite all.conf + remove client.conf 
* bug: minor: use different config-file-names on client/server
* bug: minor: release unused tunnel IDs
* feature+: explicit intranet tunnels (compression, another shaping?)
* feature+: join several tunnels into one, to corectly shape several devices with one login

config()
* bug: minor: leave already configured special network/vlan-settings
* feature+: make WAN-olsr better configureable
* feature+: repect /tmp/resolv.conf.ppp + .auto? (faster resolution)
* feature+: use special ip4 for service HNA/redundancy: 6.6.6.[5|6|7|8] = monitoring|dns|userdb|tunnelsrv

scheduler()
* bug: minor: why does it happen: "scheduler_allow_run() removing lockfile, which seems to be left by accident"
* feature+: run tasks at a specific time

net()
* cleanup: implement pingtest-abstraction and use it
* feature+: sort "/tmp/dhcp.leases" | while read LINE; do set $LINE; echo "$( _system date unixtime2date $1 ) $LINE";done

wifi()
* bug: major: b43: "BCM4318 chipset: AP mode does not work because of packet loss in high transmission rates"
* feature+: check if arping-test raised wifi-tx-counter
* feature+: b43: try module parameter 'nohwcrypt=1 qos=0' (lowering mem?)

